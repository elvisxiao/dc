/*! Tinyp2p 2016-10-18 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./dialog"),e=a("./security"),f={lastParams:null};f._send=function(a,b,c,d,g,h){var i={url:a,type:"GET",headers:{"Content-Type":"application/json"}};b&&(i.type=b),c&&(h||(c=e.removeXss(c)),i.data=JSON.stringify(c)),i.success=function(a){d(a)},g?i.error=function(a){404===a.status&&f.cb404&&f.cb404(),g(a)}:i.error=f.error;var j=$.ajax(i);window.app&&window.app.ajaxHandles&&window.app.ajaxHandles.push(j)},f.get=function(a,b,c,d){this._send(a,null,null,b,c,d)},f.post=function(a,b,c,d,e){this._send(a,"post",b,c,d,e)},f.put=function(a,b,c,d,e){this._send(a,"put",b,c,d,e)},f["delete"]=function(a,b,c,d){this._send(a,"delete",null,b,c,d)},f.error=function(a){401===a.status&&f.cb401?f.cb401():404===a.status&&f.cb404?f.cb404():(a.responseText||a.text)&&d.tips("Request error:"+(a.responseText||a.text).toString())},b.exports=f},{"./dialog":7,"./security":14}],2:[function(a,b,c){var d={};d.depthFirstInTree=function(a,b,c){c||(c="items"),a instanceof Array||(a=a[c]);var d=[],e=function(a,c,f){for(var g=0;g<a.length;g++){if(f)return;var h=a[g];if(c.push(h),h.id==b)return d=c,void(f=!0);h.items&&h.items.length&&e(h.items,c.concat([])),c.pop()}g===a.length&&c.pop()};return e(a,[],!1),d.reverse()},b.exports=d},{}],3:[function(a,b,c){!function(a,c){"use strict";function d(a,b){var c=b.toString(),d=c.substring(1,c.lastIndexOf("/")),e=c.substring(c.lastIndexOf("/")+1);return-1===e.indexOf("g")&&(b=new RegExp(d,e+"g")),a.split(b)}function e(a){return""===a.replace(/^[\s]*|[\s]*$/g,"")}function f(a){var b;for(b=0;b<a.length;b++)e(a[b])&&a.splice(b--,1)}function g(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(e=a[c].replace(/^[\s]*|[\s]*$/g,""),f="",('"'===e.charAt(0)||"'"===e.charAt(0))&&(f=e.charAt(0)),""!==f&&e.slice(-1)!==f){for(d=c+1,d<a.length&&(e=a[d].replace(/^[\s]*|[\s]*$/g,""));d<a.length&&e.slice(-1)!==f;)a[c]+=b+a.splice(d,1)[0],e=a[d].replace(/[\s]*$/g,"");d<a.length&&(a[c]+=b+a.splice(d,1)[0])}}function h(a){var b;for(b=0;b<a.length;b++)a[b]=a[b].replace(/^[\s]*|[\s]*$/g,"")}function i(a){var b;for(b=0;b<a.length;b++)'"'===a[b].charAt(0)?a[b]=a[b].replace(/^"|"$/g,""):"'"===a[b].charAt(0)&&(a[b]=a[b].replace(/^'|'$/g,""))}function j(a,b){var c=a.split(b);return g(c,b),h(c),i(c),c}function k(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=j(a[c],b);return d}function l(a){var b,c,d,e,f,g=[],h=a[0];for(b=1;b<a.length;b++)if(d=a[b],d.length>0){if(d.length>h.length)throw new SyntaxError("not enough header fields");for(e={},c=0;c<h.length;c++)f=h[c],c<d.length?e[f]=d[c]:e[f]="";g.push(e)}return g}var m={};m.parse=function(a,b,c,e){var g,h,i,j={lineEnding:/[\r\n]/,delimiter:",",ignoreEmptyLines:!0};if(""===a)throw new SyntaxError("empty input");if("undefined"!=typeof b&&(b instanceof RegExp?j.lineEnding=b:j.lineEnding=new RegExp("["+String(b)+"]","g")),"undefined"!=typeof c&&(j.delimiter=String(c)),"undefined"!=typeof e&&(j.ignoreEmptyLines=!!e),g=d(a,j.lineEnding),j.ignoreEmptyLines&&f(g),g.length<2)throw new SyntaxError("missing header");return h=k(g,j.delimiter),i=l(h)},"object"==typeof b&&b&&"object"==typeof b.exports?b.exports=m:"function"==typeof define&&define.amd?define([],function(){return m}):a.CSV=m}("undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){var d=a("./dropdown"),e=function(a){this.config={container:"body",dataList:null,limited:null,showLevel:null,onlyLast:!1},this.onchange=null,this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);$(this.config.container).addClass("buSlc");var c=this;c.formatData=function(){if(c.config.dataList.items)return void(c.treeData=$.extend({},c.config.dataList));var a={id:1,fid:0,items:[],name:"PIS",description:"",level:1},b={};b[1]=a,c.config.dataList.map(function(a){var c=a.ancestor;if(fTree=b[c],!fTree||!fTree.level)return!0;var d={id:a.descendant,fid:c,items:[],name:a.categoryName,description:a.description,level:fTree.level+1,segments:a.segments};fTree.items.push(d),b[d.id]=d}),c.treeData=a,console.log("format data",a)},c.initSelect=function(){$(c.config.container).addClass("zBuSelect");var a=$('<div class="mixSelectWrap"><p><input class="form-control zIpt" type="text" placeholder="Search here ..." /></p></div>');c.renderTree(c.treeData,a,0),c.dropdownText=a[0].outerHTML,c.bindEvents()},c.renderTree=function(a,b,d){if(a&&!(c.config.showLevel&&d>c.config.showLevel)){var e=$("<ul></ul>");if(a&&void 0===a.length)return c.renderTree(a.items,e,1),void e.appendTo(b);for(var f=a.length,g=0;f>g;g++){var h=a[g];h.level=d;var i=$('<li><p style="padding-left: '+15*d+'px" data-id="'+h.id+'">'+h.name+"</p></li>");i.appendTo(e),h.items&&h.items.length>0&&this.renderTree(h.items,i,d+1)}e.find("li").length>0&&(e.appendTo(b),c.config.onlyLast&&e.prev("p").addClass("disabled"))}},c.getResult=function(){var a=[];return $(c.config.container).find(".zBadge").each(function(){var b=$(this);a.push(parseInt(b.attr("data-id")))}),a},c.getResultModels=function(){var a=this.getResult(),b=[];return function(c){if(c&&c.items&&c.items.map)for(var d=0;d<c.items.length;d++){var e=c.items[d];-1!==$.inArray(parseInt(e.descendant||e.id),a)&&(e.parent=c,b.push(e)),arguments.callee.call(this,e)}}(c.config.dataList),b},c.getNameById=function(a){var b=$(c.dropdownText);return b.find('p[data-id="'+a+'"]:eq(0)').text()},c.getLevelById=function(a){var b=$(c.dropdownText);return b.find('p[data-id="'+a+'"]:eq(0)').parents("li").length},c.getIdByName=function(a){var b=$(c.dropdownText),d=null;return b.find("p[data-id]:contains("+a+")").each(function(){var b=$(this).text();return b===a?d=$(this).attr("data-id"):void 0}),d},c.setResult=function(a,b){var d=$(c.config.container).html("");if(a&&a.length){for(var e=0;e<a.length;e++){var f=a[e],g=f.name;g||(g=c.getNameById(f.id)),d.append('<label class="zBadge" data-id="'+f.id+'"><i class="icon-cancel-circle"></i>'+g+"</label>")}b&&d.find(".zBadge .icon-cancel-circle").remove(),c.onchange&&c.onchange()}},c.bindEvents=function(){var a=$(c.config.container);a.off("click").on("click",".zBadge .icon-cancel-circle",function(b){b.stopPropagation(),$(this).parent().remove(),d.remove(a),c.onchange&&c.onchange()}).on("click",function(b){b.stopPropagation(),d.remove(a);var e=d.show(this,"",c.dropdownText),f=e.find(".mixSelectWrap>ul");a.find(".zBadge").each(function(){var a=$(this),b=this.getAttribute("data-id"),c=f.find('p[data-id="'+b+'"]').addClass("active").data("target",a);c.parent().find(">ul").hide()}),e.on("click","ul li p:not(.disabled)",function(b){var e=$(this);if(e.hasClass("active"))e.removeClass("active").data("target").remove(),e.data("target",null),e.parent().find(">ul").show(),c.onchange&&c.onchange();else{e.addClass("active");var f=$('<label class="zBadge" data-id="'+e.attr("data-id")+'"><i class="icon-cancel-circle"></i>'+e.html()+"</label>");if(f.appendTo(a),e.data("target",f),e.parent().find(">ul").hide().find("p").each(function(){var a=$(this).removeClass("active");a.data("target")&&a.data("target").remove(),a.data("target",null)}),c.config.limited>0){var g=a.find(".zBadge").length;g-c.config.limited>0&&a.find(".zBadge:eq("+(g-2)+")").remove(),d.remove(a)}c.onchange&&c.onchange()}}).on("input",".zIpt",function(){var a=$.trim(this.value).toUpperCase();e.find("ul p").hide().each(function(){var b=$(this);-1!==b.html().toUpperCase().indexOf(a)&&(b.show(),b.parents("li").find(">p").show())})})}),$("body").off("click",".zDropdown").on("click",".zDropdown",function(a){a.stopPropagation()}),$("body").on("click",function(){d.remove(a)})},c.formatData(),c.initSelect()};b.exports=e},{"./dropdown":8}],5:[function(a,b,c){var d={};d.processRow=function(a){for(var b="",c=0;c<a.length;c++){var d=null===a[c]?"":a[c].toString();a[c]instanceof Date&&(d=a[c].toLocaleString());var e=d.replace(/"/g,'""');e.search(/("|,|\n)/g)>=0&&(e='"'+e+'"'),c>0&&(b+=","),b+=e}return b+"\n"},d.getCsvString=function(a){for(var b="",c=0;c<a.length;c++)b+=d.processRow(a[c]);return b},d["export"]=function(a,b){var c=d.getCsvString(b),e=new Blob([c],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(e,a);else{var f=document.createElement("a");if(void 0!==f.download){var g=URL.createObjectURL(e);f.setAttribute("href",g),f.setAttribute("download",a),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}},b.exports=d},{}],6:[function(a,b,c){var d={};d.format=function(a,b){if(!a)return"";a.toString().indexOf("-")>0&&10===a.toString().length?a=a.toString().replace(/-/g,"/"):/^\d{8}$/.test(a)&&(a=a.toString().replace(/(\d{4})(\d{2})/g,"$1/$2/"));var c={yyyy:"year",hh:"hours",mm:"month",dd:"date",hh:"hours",MM:"minites",ss:"seconds",ms:"millSeconds"},a=new Date(a),d={year:a.getFullYear(),month:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minites:a.getMinutes(),seconds:a.getSeconds(),millSeconds:a.getMilliseconds()};b||(b="yyyy-mm-dd");for(var e in c){var f=c[e],g=d[f];g.toString().length<2&&(g="0"+g.toString()),b=b.replace(e,g)}return b},d.getUTCTimespan=function(a){var a=new Date(a);return a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),a.getTime()},d.formatUTC=function(a,b){if(!a)return"";var a=d.getUTCTimespan(a);return d.format(a,b)},d.formatPDT=function(a,b){if(!a)return"";var a=d.getUTCTimespan(a),c=a-288e5;return d.format(c,b)},d.getLocaleTimespan=function(a){return a&&"string"==typeof a?(a=a.replace(/(^\s*)|(\s*$)/g,""),a.length<10?null:(10===a.length?a+=" 00:00:00":13===a.length&&(a+=":00:00"),new Date(a).getTime())):null},d.compare=function(a,b){"string"==typeof a&&(a=a.replace(/-/g,"/")),"string"==typeof b&&(b=b.replace(/-/g,"/"));var a=new Date(a).getTime(),b=new Date(b).getTime();return a-b},d.getWeeksByYear=function(a){var b=52,a=parseInt(a+""),c=[1994,2e3,2005,2011,2016,2022,2028,2033,2039,2044,2050,2056,2061,2067,2072,2078,2084,2089,2095,2101,2107,2112,2118,2124,2129,2135,2140,2146,2152,2157,2163,2168,2174,2180,2185,2191,2196,2203,2208,2214,2220,2225,2231,2236,2242,2248,2253,2259,2264,2270,2276,2281,2287,2292,2298,2304,2310,2316,2321,2327,2332,2338,2344,2349,2355,2360,2366,2372,2377,2383,2388,2394];return-1!==$.inArray(a,c)&&b++,b},d.getWeekString=function(a){if(a||(a=new Date),"string"==typeof a)if(a.indexOf("-")>-1)a=a.replace(/-/g,"/");else{var b=a.slice(0,4),c=a.slice(4,6),d=a.slice(6);a=b+"/"+c+"/"+d}if(a=new Date(a),11==a.getMonth()&&a.getDate()>20){var e=new Date(a);if(e.setDate(e.getDate()+6-e.getDay()),e.getFullYear()>a.getFullYear())return 100*e.getFullYear()+1}var f=new Date(a.getFullYear(),0,1),d=f.getDay();if(f.setDate(8-f.getDay()),f>a)return 100*a.getFullYear()+1;var g=Math.floor((a-f)/6048e5);return 100*a.getFullYear()+g+2},d.getStartDateByWeek=function(a){if(!a)return"";"string"==typeof a&&(a=parseInt(a));var b=Math.floor(a/100),c=a%100,d=new Date(b,0,1);return d.setDate(7*(c-1)+1-d.getDay()),d},d.getNextWeek=function(a){"string"==typeof a&&(a=a.replace(/-/g,""),a=parseInt(a));var b=Math.floor(a/100),c=a%100;return 52>c?100*b+c+1:53==c?100*(b+1)+1:52==this.getWeeksByYear(b)?100*(b+1)+1:100*b+c+1},d.weekPicker=function(a){var a=$(a),b=$.trim(a.val()),c=function(){var a=$('<table class="zWeekPicker"></table>'),c=$("<thead></thead>").appendTo(a),e=new Date;b||(b=d.getWeekString(e).toString());var f=b.slice(0,4),g=b.slice(4);c.append('<tr><th colspan="100"><i class="icon-arrow-left"></i><span class="spanYear">'+f+'</span><i class="icon-arrow-right"></i></th></tr>');for(var h=$("<tbody></tbody>").appendTo(a),i=d.getWeeksByYear(f),j=$("<tr></tr>").appendTo(h),k=0;i>k;k++){k%7===0&&(j=$("<tr></tr>").appendTo(h));var l=(k+1).toString();9>k&&(l="0"+l),j.append("<td>"+l+"</td>")}h.find("td:contains("+g+"):not(.zWeekPickerTag)").addClass("active");var m=d.getStartDateByWeek(f+g),n=m.getTime()+5184e5;return n=d.format(n,"mmdd"),m=d.format(m,"mmdd"),h.find("tr:last-child").append('<td colspan="10" class="zWeekPickerTag"><i class="icon-clock2"></i><span>'+m+" - "+n+"</span></td>"),a.on("click","thead i",function(b){var c=$(this),e=c.parent().find(".spanYear"),f=parseInt(e.text());c.hasClass("icon-arrow-left")?f--:f++,i=d.getWeeksByYear(f),52==i?a.find("td:contains(53)").remove():0===a.find("td:contains(53)").length&&$("<td>53</td>").insertBefore(a.find("td.zWeekPickerTag")),e.html(f)}).on("mouseenter","tbody td:not(.zWeekPickerTag)",function(){var a=this.innerHTML,b=$(this).parents("table:eq(0)").find(".spanYear").html(),c=d.getStartDateByWeek(b+a),e=c.getTime()+5184e5;e=d.format(e,"mmdd"),c=d.format(c,"mmdd"),h.find("td.zWeekPickerTag span").html(c+" - "+e)}).on("mouseleave","tbody",function(){var a=d.getStartDateByWeek(f+g),b=new Date(a).getTime()+5184e5;b=d.format(b,"mmdd"),a=d.format(a,"mmdd"),h.find("td.zWeekPickerTag span").html(a+" - "+b)}).on("click",function(a){a.stopPropagation()}),$("body").on("click",function(){a.hide()}),a.appendTo("body"),a},e=function(a){var b=$(".zWeekPicker");0===b.length&&(b=c());var e=a.offset(),f=$.trim(a.val());f&&6===f.length||(f=d.getWeekString(new Date).toString());var g=f.slice(0,4),h=f.slice(4),i=d.getStartDateByWeek(g+h),j=i.getTime()+5184e5;j=d.format(j,"mmdd"),i=d.format(i,"mmdd"),b.find(".spanYear").html(g),b.find("td.active").removeClass("active"),b.find("td:contains("+h+"):not(.zWeekPickerTag)").addClass("active"),b.find(".zWeekPickerTag>span").html(i+" - "+j);var k=e.left;k+b.outerWidth()>$("body").width()&&(k=e.left-b.outerWidth()+a.outerWidth()),b.css({left:k,top:e.top+a.outerHeight(),display:"block"}),b.off("click","tbody td:not(.zWeekPickerTag)").on("click","tbody td:not(.zWeekPickerTag)",function(){b.hide();var c=b.find(".spanYear").text(),d=$(this).html(),e=c+d;a.val(e),a.change()})};a=$(a),a.on("click",function(b){b.stopPropagation(),e(a)})},b.exports=d},{}],7:[function(a,b,c){var d={template:'<div class="zDialogCover"><div class="zDialog"><div class="zDialogHd"></div><div class="zDialogBd"></div><div class="zDialogFt"><button class="zDialogOk" type="button">确 认</button><button class="zDialogCancel" type="button">取 消</button></div></div></div>'};d.removeMadal=function(){this.removeAllTips(),this.close(),d.resetBody()},d.removeAllTips=function(){$(".zLoading, .tips").remove(),d.resetBody()},d.tips=function(a,b,c){if(a){void 0===b&&(b=1500),"function"==typeof b&&(c=b,b=1500);var e=$(d.template).addClass("tips");return e.find(".zDialogFt").remove(),e.find(".zDialogBd").html(a),b>0?(e.find(".zDialogHd").remove(),setTimeout(function(){e.remove(),c&&c(),d.resetBody()},b)):(e.find(".zDialogHd").append('Tips<i class="zDialogClose close">×</i>'),e.on("click",".zDialogClose",function(){e.remove(),c&&c(),d.resetBody()})),e.appendTo("body"),$(document.body).addClass("zDialogOn"),e}},d.loading=function(a){this.removeMadal();var b=$(d.template).addClass("tips");return b.find(".zDialogHd, .zDialogFt").remove(),b.find(".zDialogBd").html('<div class="zLoadingIcon"></div>'+a),b.appendTo("body"),b},d.resetBody=function(){0===$(".zDialogCover").length&&$(document.body).removeClass("zDialogOn")},d.confirm=function(a,b,c,e,f){var g=$(d.template);return g.find(".zDialogBd").html(a),g.find(".zDialogHd").remove(),g.appendTo("body").on("click",".zDialogOk, .zDialogCancel",function(){var a=g.find("input, textarea"),h="";if(a.length>0&&(h=a.val()),$(this).hasClass("zDialogOk")){if(e===!0&&a.length>0&&!h)return d.tips("message is required."),void a.focus();f!==!1?(b&&b(h),g.remove(),d.resetBody()):h?b&&b(h,function(){g.remove(),d.resetBody()}):b&&b(function(){g.remove(),d.resetBody()})}else c&&c(h),g.remove(),d.resetBody()}).on("click","input, textarea",function(){g.removeClass("has-error")}),g.focus(),$(document.body).addClass("zDialogOn"),g},d.open=function(a,b,c,e){this.removeMadal(),b||(b=a,a="");var f=$(d.template);return f.find(".zDialogHd").append(a+'<i class="zDialogClose close">×</i>'),f.find(".zDialogBd").append(b),typeof c!==!0&&e!==!0&&f.find(".zDialogFt").remove(),f.appendTo(document.body),$(document.body).addClass("zDialogOn"),c&&"function"==typeof c&&setTimeout(c,300),f.on("click",".close, .zDialogClose, .zDialogCancel",function(){f.onclose&&f.onclose(),f.onClose&&f.onClose(),f.remove(),d.resetBody()}),f},d.close=function(a){a?(a=$(a),a.hasClass("zDialogCover")||(a=a.parents(".zDialogCover"))):a=$(".zDialogCover"),a.remove(),d.resetBody()},d.tooltips=function(a,b){b=$(b);var c=$('<span class="zTooltips none">'+a+"</span>");return c.appendTo("body"),c.fadeIn(500,function(){setTimeout(function(){c.fadeOut(500,function(){c.remove()})},1500)}),c.css({left:b.offset().left-parseInt(c.css("width"))-20,top:b.offset().top}),c},d.warn=function(a,b){b=$(b);var c=function(a){if(a){a=a.target||a.srcElement||a,a=$(a);var b=a.data("target");b&&(b.data("timer")&&clearTimeout(b.data("timer")),b.remove(),a.data("target",null))}};b.data("target")&&c(b),b.off("click",c),b.on("click",c),b.on("blur",c);var d=$('<span class="zTooltips warn none">'+a+"</span>");return b.after(d),d.fadeIn(200,function(){var a=setTimeout(function(){c()},5e3);d.data("timer",a)}),d.css({left:b.position().left,top:b.position().top+b.height()+10}),b.data("target",d),d},b.exports=d},{}],8:[function(a,b,c){b.exports={show:function(a,b,c,d){var a=$(a);if(!a.data("zTarget")){var e=$('<div class="zDropdown" tabindex="1"><div class="zDropdownBd"></div></div>');if(e.find(".zDropdownBd").append(c),b){var f=$('<div class="zDropdownHd"></div>').append(b);e.prepend(f)}return e.appendTo("body"),this._setPosition(a,e,b,d),e.data("zTarget",a),a.data("zTarget",e),e}},remove:function(a){a?(a=$(a),a.hasClass("zDropdown")||(a=a.data("zTarget"))):a=$(".zDropdown"),a&&a.each&&a.each(function(){var a=$(this),b=a.data("zTarget");a.remove(),a.data("zTarget",null),b&&b.data("zTarget",null)})},_setPosition:function(a,b,c,d){var e=a.offset(),f=e.left,g=e.top,h=$(window),i={upTop:g-b.outerHeight()-8,downTop:g+a.outerHeight()+8,leftLeft:f,rightLeft:f-b.outerWidth()+a.outerWidth()},j=i.leftLeft;"right"===d&&i.rightLeft>h.scrollLeft()?(j=i.rightLeft,b.addClass("zDropdownRight")):f+b.outerWidth()>h.scrollLeft()+h.width()&&(j=i.rightLeft,b.addClass("zDropdownRight"));var k=i.downTop;if("up"===d&&i.upTop>h.scrollTop())k=i.upTop,b.addClass("zDropdownUp");else if(k+b.height()>h.outerHeight()+h.scrollTop())if(k=i.upTop,k<h.scrollTop()){var l=g-h.scrollTop(),m=h.outerHeight()-l-a.outerHeight(),n=l>m?l:m;b.css("height",n-20),c&&b.find(".zDropdownBd").css("height",n-40),m>l?k=i.downTop:(k=g-b.outerHeight()-8,b.addClass("zDropdownUp"))}else b.addClass("zDropdownUp");b.css({left:j,top:k,"min-width":a.outerWidth()})}}},{}],9:[function(a,b,c){var d=a("./dialog.js"),e=a("./ui.js"),f=function(b){this.csv=a("./asset/csv"),this.ele=null,this._dataList=[],this.canEdit=!0,this.maxHeight=800,this.config={container:"body",canEdit:!0,maxHeight:800,heads:[],removeEmptyLine:!1,afterLoad:null,validHeads:null};for(var c in b)this.config.hasOwnProperty(c)&&(this.config[c]=b[c]);var f=this;f._render=function(){f.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(f._renderNoFile()),f.ele.append(a),f.ele.appendTo(f.config.container)},f._renderNoFile=function(){var a=$('<div class="zUploaderNoFile" style="padding:15px 0 0 0;"></div>');return a.append('<span class="zUploaderFileBtn "><input type="file" accept=".csv,.xls" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里, 暂仅支持CSV/XLS格式的文件</p>"),a},f._bindEvent=function(){f.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){f._readFilesToTable(this.files[0]);var a=f.ele.find('.zUploaderFileBtn input[type="file"]');a.replaceWith(a[0].outerHTML)}),f.ele.find(".zUploaderNoFile")[0].addEventListener("drop",function(a){$(this).css("border","3px dashed #e6e6e6"),a.preventDefault(),f._readFilesToTable(a.dataTransfer.files[0])}),f.ele.on("dragenter",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #aaa")}).on("dragleave",".zUploaderNoFile",function(a){a.preventDefault(),$(this).css("border","3px dashed #e6e6e6")}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}}),f.ele.on("change",".zFileTable tbody td input",function(){var a=this.value,b=$(this),c=b.parent(),d=c.attr("data-index"),e=d.split(","),g=e[0],h=e[1];f._dataList[g][h]=a})},f.read=function(a,b){-1===a.name.indexOf(".csv")?f.readXls(a,b):f.readCsv(a,b)},f.readXls=function(a,b){var c=new XMLHttpRequest;c.open("POST","/product/util/xlsReader.jsp",!0);var d=new FormData;d.append("file",a),c.upload.onerror=function(a){oc.dialog.tips("上传文件时发生错误，请稍后再试"),e.loading(f.ele,!0),b()},c.onreadystatechange=function(){if(4==c.readyState&&200!==c.status)return oc.dialog.tips("文件传输中断:"+c.statusText),e.loading(f.ele,!0),void b();if(4==c.readyState&&200==c.status){e.loading(f.ele,!0);try{f._dataList=JSON.parse(c.response),f.config.removeEmptyLine&&(f._dataList=f._dataList.filter(function(a){var b=!0;for(var c in a)a[c].toString().trim()&&(b=!1);return!b})),b()}catch(a){oc.dialog.tips("文件解析错误:"+a),b()}}},e.loading(f.ele),c.send(d)},f.readCsv=function(a,b){var c=new FileReader,d=!1;c.onload=function(e){$('input[type="file"]').replaceWith($('<input type="file" accept=".csv,.xls">'));var g=c.result;return-1===g.indexOf("�")||d?(f._formatFileContent(g),void b()):(c.readAsText(a,"GB2312"),void(d=!0))},c.readAsText(a)},f._formatFileContent=function(a){var b=null;try{b=f.csv.parse(a)}catch(c){return console.log("转换csv失败：",c),void d.tips("文件读取失败，请检查文件格式",-1)}var e=b[0],g=[];for(var h in e)g.push(h);f._dataList=[],f._dataList.push(g);for(var i=0;i<b.length;i++){var j=b[i],k=[],l=!0;for(var h in j){var m=$.trim(j[h]);m&&(l=!1),k.push(m)}l&&f.config.removeEmptyLine||f._dataList.push(k)}},f._removeEmptyCols=function(){var a=f._dataList[0].concat();a=a.reverse();for(var b=0,c=0;c<a.length;c++)($.trim(a[c])||0!==b)&&b++;a.reverse(),f._dataList=f._dataList.map(function(a){return a.slice(0,b)})},f._readFilesToTable=function(a){f.read(a,function(){$(".zFileTableContainer").remove();var a=$('<div class="zFileTableContainer"><table class="zFileTable"></table></div>');f.config.maxHeight&&a.css("max-height",f.config.maxHeight+"px");var b=a.find(".zFileTable");if(f._dataList&&f._dataList.length>0){f._removeEmptyCols();var c=f._dataList[0];if(f.config.validHeads&&f.config.validHeads.length){if(f.config.validHeads.length!==c.length)return void oc.dialog.tips("File head error: "+f.validHeads.join(","));f.config.validHeads.map(function(a,b){return c[b].toString().trim()!==a.toString().trim()?void oc.dialog.tips("File head error: "+f.config.validHeads.join(",")):void 0})}for(var d=c.length,e=$("<thead></thead>"),g=$("<tbody></tbody>"),h=$("<tr><th>NO.</th></tr>").appendTo(e),i=0;d>i;i++)h.append("<th>"+c[i]+"</th>");for(var i=1;i<f._dataList.length;i++){for(var j=f._dataList[i],k=$("<tr><td>"+i+"</td></tr>"),l=0;d>l;l++){var m=j[l];f.config.canEdit&&(m='<span class="tdSpan">'+m+'</span><input class="tdIpt" type="text" value="'+m+'" />'),k.append('<td data-val="true", data-index="'+i+","+l+'">'+m+"</td>")}g.append(k)}b.append(e),b.append(g)}var n=f.ele.find(".zUploaderList");n.find(".zFileTable").remove(),a.appendTo(n),f.config.afterLoad&&f.config.afterLoad()})},f.setEditTable=function(a){f.config.canEdit===!0&&a.find("tbody td[data-val]").each(function(){var a=$(this),b=a.html();a.html('<span class="tdSpan">'+b+'</span><input class="tdIpt" type="text" value="'+b+'" />')})},f.getDataList=function(){var a=[];if(!f._dataList||0===f._dataList.length)return null;var b=f._dataList[0];f.config.heads&&f.config.heads.length>0&&(f.config.heads.length>b.length&&(f.config.heads=f.config.heads.slice(0,b.length)),b=b.slice(f.config.heads.length),b=f.config.heads.concat(b));for(var c=b.length,d=1;d<f._dataList.length;d++){for(var e=f._dataList[d],g={},h=0;c>h;h++)g[b[h]]=$.trim(e[h]);a.push(g)}return a},f.mark=function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=d.row+","+d.col,g=f.ele.find('tbody td[data-index="'+e+'"]');g.addClass("zFileTableMark").attr("title",d.msg)}},f.clearMark=function(){f.ele.find("tbody .zFileTableMark").removeAttr("title").removeClass("zFileTableMark")},f._render(),f._bindEvent()};b.exports=f},{"./asset/csv":3,"./dialog.js":7,"./ui.js":27}],10:[function(a,b,c){var d=function(a){this.config={container:"body",remoteImg:0},this.ele=null,this.canvas=null,this.ctx=null,this.img=null,this.filter=null,this.scaleHeight=0,this.scaleWidth=0;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<div class="zImageCrop"></div>');var a=$('<div class="zImageCropWrap"></div>').appendTo(c.ele);a.append('<canvas class="zImageCropCanvas"></canvas>'),a.append('<span class="zImageCropCover zImageCropCoverTop"></span>'),a.append('<span class="zImageCropCover zImageCropCoverRight"></span>'),a.append('<span class="zImageCropCover zImageCropCoverLeft"></span>'),a.append('<span class="zImageCropCover zImageCropCoverBottom"></span>'),a.append('<span class="zImageCropFilter"><i class="zCutDown"></i><i class="zCutLeft"></i><i class="zCutRight"></i><i class="zCutUp"></i></span>'),c.ele.append('<div class="zImageCropControl"><span class="iptFile"><input type="file" accept="image/*">Open</span><span class="zCutRange"><b>－</b><input type="range" min="50" max="500" step="1"><b>＋</b><span class="zRangePercent">0%</span></span><span class="zCutImageSize">0 × 0</span><button class="btnCut">Cut</button></div>'),c.ele.append('<h3 class="zImageCropDropInfo mt50">Drop image here</h3>'),c.canvas=c.ele.find("canvas")[0],c.ctx=c.canvas.getContext("2d"),c.img=new Image,c.filter=c.ele.find(".zImageCropFilter"),c.ele.appendTo(c.config.container),c.config.remoteImg&&c.readFile(c.config.remoteImg),c.bindEvents()},c.supportDrop=function(){c.ele.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}).on("dragenter",function(a){a.stopPropagation(),a.preventDefault(),c.ele.addClass("zImageCropDrag")}).on("dragleave",function(a){a.stopPropagation(),a.preventDefault(),c.ele.removeClass("zImageCropDrag")}),c.ele.on("drop",function(a){a.stopPropagation(),a.preventDefault(),c.ele.removeClass("zImageCropDrag");var b=a.originalEvent.dataTransfer.files;c.readFile(b[0])})},c.imgLoaded=function(){c.ele.find(".zImageCropDropInfo").hide(),c.ele.find(".zImageCropFilter").css("display","block"),c.drawImage(),c.scaleWidth=c.img.width,c.scaleHeight=c.img.height,c.ele.find(".zCutImageSize").html(c.img.width+" × "+c.img.height),c.ele.find(".zCutRange input").val(100),c.ele.find(".zRangePercent").html("100%")},c.readFile=function(a){var b=new FileReader;if(b.onload=function(a){c.img.src=this.result,c.imgLoaded()},"object"==typeof a){if(!/image\/.*/.test(a.type))return void(window.oc?oc.dialog.tips("Only image file is accept"):alert("Only image file is accept"));b.readAsDataURL(a)}else c.img.src=a,c.img.onload=c.imgLoaded},c.bindEvents=function(){c.downWidth=c.filter.width(),c.downHeight=c.filter.height(),c.downLeft=c.filter.position().left,c.downTop=c.filter.position().top,c.downPosition={};new FileReader;c.supportDrop(),c.ele.on("change",'input[type="file"]',function(){c.readFile(this.files[0])}).on("input",'.zImageCropControl input[type="range"]',function(){c.ele.find(".zImageCropControl .zRangePercent").html(this.value+"%"),c.range()}).on("click",".zImageCropControl b",function(){var a=parseInt(c.ele.find(".zImageCropControl .zRangePercent").html());"－"===this.innerHTML?(a-=10,50>a&&(a=50)):(a+=10,a>500&&(a=500)),c.ele.find(".zImageCropControl .zRangePercent").html(a+"%"),c.ele.find('.zImageCropControl input[type="range"]').val(a),c.range()}).on("click",".btnCut",c.cutImage).on("mousedown",".zImageCropFilter",function(a){1===a.which?(c.downPosition=a.originalEvent,downLeft=c.filter.position().left,downTop=c.filter.position().top,$(document).off("mousemove"),$(document).on("mousemove",function(a){c.moveFilter(a)})):(console.log("off move"),$(document).off("mousemove"))}).on("mousedown",".zImageCropFilter i",function(a){a.stopPropagation(),c.downWidth=c.filter.width(),c.downHeight=c.filter.height(),c.downLeft=c.filter.position().left,c.downTop=c.filter.position().top;var b=$(this);1===a.which?(c.downPosition=a.originalEvent,$(document).off("mousemove"),$(document).on("mousemove",function(a){c.moveFilterIcon(a,b)})):(console.log("off move"),$(document).off("mousemove"))}),$(document).on("mouseup",function(){$(document).off("mousemove")})},c.drawImage=function(){c.img.src&&(c.canvas.width=c.img.width,c.canvas.height=c.img.height,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height),c.ctx.drawImage(c.img,0,0,c.img.width,c.img.height),c.resetCover())},c.range=function(){var a=c.ele.find('.zImageCropControl input[type="range"]').val();c.canvas.width=c.scaleWidth*a/100,c.canvas.height=c.scaleHeight*a/100,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.drawImage(c.img,0,0,c.canvas.width,c.canvas.height),c.resetFilter(),c.resetCover()},c.cutImage=function(){if(c.img.src){c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height);var a=c.ele.find('.zImageCropControl input[type="range"]').val()/100,b=c.filter.width(),d=c.filter.height();c.canvas.width=b,c.canvas.height=d,$(c.canvas).parent().css({"margin-left":c.canvas.width/-2,"margin-top":c.canvas.height/-2}),c.ctx.drawImage(c.img,c.filter.position().left/a,c.filter.position().top/a,b/a,d/a,0,0,b,d),c.resetFilter(),c.resetCover(),c.ele.find(".zImageCropCover").css({width:0,height:0}),c.ele.find('.zImageCropControl input[type="range"]').val(100),c.ele.find(".zImageCropControl .zRangePercent").html("100%"),c.ele.find(".zImageCropControl .zCutImageSize").html(b+" × "+d),c.scaleWidth=b/a,c.scaleHeight=d/a,c.img.src=c.canvas.toDataURL("image/png")}},c.moveFilter=function(a){var b=a.originalEvent,d=downLeft+b.clientX-c.downPosition.clientX,e=downTop+b.clientY-c.downPosition.clientY;0>d&&(d=0),0>e&&(e=0),c.resetFilter(),c.resetCover()},c.resetFilter=function(){var a=$(c.canvas).parent(),b=parseInt(a.css("margin-left"))+c.ele.width()/2,d=c.ele.width()-c.canvas.width-b,e=parseInt(a.css("margin-top"))+c.ele.height()/2,f=c.ele.height()-c.canvas.height-e;0>b?b*=-1:b=0,0>d?d*=-1:d=0,0>f?f*=-1:f=0,0>e?e*=-1:e=0,c.filter.css({width:"auto",height:"auto",left:b,right:d,top:e,bottom:f})},c.resetCover=function(){var a=c.filter.position();c.ele.find(".zImageCropCoverTop").css({height:a.top,width:"100%",left:0,top:0}),c.ele.find(".zImageCropCoverBottom").css({height:c.canvas.height-a.top-c.filter.height()-2,width:"100%",bottom:"2px",left:0}),c.ele.find(".zImageCropCoverRight").css({width:c.canvas.width-c.filter.width()-a.left,height:c.filter.height()+2,top:a.top,right:0}),c.ele.find(".zImageCropCoverLeft").css({width:a.left,height:c.filter.height()+2,top:a.top,left:0})},c.moveFilterIcon=function(a,b){a.stopPropagation();var d=a.originalEvent,e=$(b),f=e.parent(),g=d.clientX-c.downPosition.clientX,h=d.clientY-c.downPosition.clientY,i=c.downWidth+g,j=c.downHeight+h,k=$(c.canvas).parent(),l=parseInt(k.css("margin-left"))+c.ele.width()/2,m=c.ele.width()-c.canvas.width-l,n=parseInt(k.css("margin-top"))+c.ele.height()/2,o=c.ele.height()-c.canvas.height-n;if(b.hasClass("zCutRight")){var p=c.canvas.width+m-c.downLeft;0>m&&i>p?i=p:m>0&&(p=c.canvas.width-c.downLeft,i>p&&(i=p)),f.css({width:i})}else if(b.hasClass("zCutDown")){var p=c.canvas.height+o-c.downTop;0>o&&j>p?j=p:o>0&&(p=c.canvas.height-c.downTop,j>p&&(j=p)),f.css({height:j})}else b.hasClass("zCutLeft")?(0>l&&c.downLeft+l<=-1*g?g=-1*(c.downLeft+l):l>0&&c.downLeft<=-1*g&&(g=-1*c.downLeft),
f.css({left:c.downLeft+g,width:c.downWidth-g+2})):b.hasClass("zCutUp")&&(0>n&&c.downTop+n<=-1*h?h=-1*(c.downTop+n):n>0&&c.downTop<=-1*h&&(h=-1*c.downTop),f.css({top:c.downTop+h,height:c.downHeight-h+2}));c.resetCover()},c.render()};b.exports=d},{}],11:[function(a,b,c){!function(){window.oc={},oc.ui=a("./ui"),oc.algorithm=a("./algorithm"),oc.dialog=a("./dialog"),oc.localStorage=a("./localStorage"),oc.FileView=a("./fileView"),oc.Uploader=a("./uploader"),oc.select=a("./select"),oc.TreeSelect=a("./treeSelect"),oc.BUSelect=a("./buSelect"),oc.TreeDialogSelect=a("./treeDialogSelect"),oc.Tree=a("./tree"),oc.ImageCrop=a("./imageCrop"),oc.Sidebar=a("./sidebar"),oc.TreeOrganization=a("./treeOrganization"),oc.TreePIS=a("./treePIS"),oc.ajax=a("./ajax"),oc.date=a("./date"),oc.Table=a("./table"),oc.location=a("./location"),oc.tools={dojo:a("./toolsDojo"),csv:a("./csvExport"),table:a("./toolsTable"),number:a("./toolsNumber"),form:a("./toolsForm")};var b=$("script[data-occss]").attr("data-occss");b?($("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head"),b=b.replace("oc.css","icons/style.css"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:b}).appendTo("head")):location.href.indexOf("ocdebug")>-1?($("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://localhost:3009/dest/oc.css"}).appendTo("head"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://localhost:3009/icons/style.css"}).appendTo("head")):($("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://static.oceanwing.com/webapp/js/oc/oc.css"}).appendTo("head"),$("<link>").attr({rel:"stylesheet",type:"text/css",href:"http://static.oceanwing.com/webapp/js/oc/icons/style.css"}).appendTo("head")),window.z&&(window.z=oc.dialog),$(function(){window.z&&(window.z=oc.dialog)}),setTimeout(function(){window.z&&(window.z=oc.dialog)},1e3)}()},{"./ajax":1,"./algorithm":2,"./buSelect":4,"./csvExport":5,"./date":6,"./dialog":7,"./fileView":9,"./imageCrop":10,"./localStorage":12,"./location":13,"./select":15,"./sidebar":16,"./table":17,"./toolsDojo":18,"./toolsForm":19,"./toolsNumber":20,"./toolsTable":21,"./tree":22,"./treeDialogSelect":23,"./treeOrganization":24,"./treePIS":25,"./treeSelect":26,"./ui":27,"./uploader":28}],12:[function(a,b,c){var d={storage:window.localStorage};d.set=function(a,b){if("string"!=typeof a)return void console.error("key mast to be a string");var c=JSON.stringify(b);this.storage[a]=c},d.get=function(a){if("string"!=typeof a)return console.error("key mast to be a string"),null;var b=this.storage[a]||null,c=JSON.parse(b);return c},d.remove=function(a){this.storage.removeItem(a)},d.clear=function(){this.storage.clear()},b.exports=d},{}],13:[function(a,b,c){var d={};d._generateString=function(a){if("string"==typeof a)return a;if("object"==typeof a){var b=[];for(var c in a)b.push(c+"="+a[c]);return b.join("&")}return null},d.getString=function(a){return this._generateString(a)},d.getParams=function(a){a||(a=window);var b,c={};if(b=a.location.search,b&&b.indexOf("=")>-1){b=b.slice(1);var d=b.split("&");d.map(function(a){var b=a.split("="),d=b[0],e=decodeURI(b[1]);e.indexOf(",")>-1&&(e=e.split(",")),c[d]?("object"!=typeof c[d]&&(c[d]=[c[d]]),c[d].push(e)):c[d]=e})}return c},d.setHash=function(a,b,c){var e=d._generateString(b),f=a+(e?"?"+e:""),g={url:f};top.history.pushState(g,"",f),("boolean"==typeof a||"boolean"==typeof b||c===!0)&&window.app&&window.app.loadPage()},d.setSearch=function(a,b){var c=d._generateString(a);if(c){var e="?"+c,f={url:e};top.history.pushState(f,"",e)}("boolean"==typeof a||b===!0)&&window.app&&window.app.loadPage()},d.setUrl=function(a,b,c,e){var f=a,g=d._generateString(b);g&&(f+="?"+g),c&&(f+=c);var h={url:f};top.history.pushState(h,"",f),("boolean"==typeof a||"boolean"==typeof b||"boolean"==typeof c||e===!0)&&window.app&&window.app.loadPage()},b.exports=d},{}],14:[function(a,b,c){var d={};d.removeXss=function(a){for(var b in a){var c=a[b];if(c)if("string"==typeof c)a[b]=c.replace(/</g,"&lt;").replace(/>/g,"&gt;");else if("object"==typeof c&&c.length)for(var e=0;e<c.length;e++){var f=c[e];d.removeXss(f)}else"object"==typeof c&&d.removeXss(c)}return a},b.exports=d},{}],15:[function(a,b,c){var d=a("./dropdown"),e=function(a,b){g(a,b)},f=function(a){var b=[];return a.find("option").each(function(){this.selected&&b.push($(this).text())}),b},g=function(a,b){a||(a=$(".zSlc")),void 0===b&&(b=!0),a.each(function(){var a=$(this);divSlc=a.next(".zSlcWrap");var c=divSlc.find("input");if(0===divSlc.length){divSlc=$('<div class="zSlcWrap"></div>'),c=$('<input class="zIpt" type="text" readonly/>').appendTo(divSlc).data("showFilter",b);a.position();divSlc.css({position:"relative",display:a.css("display"),width:a.outerWidth(),height:a.outerHeight()}),a.after(divSlc)}var d=f(a).join(", ");c.val(d||""),a.hide()})},h=function(){$(function(){g(),$("body").on("click",function(){d.remove($(".zSlcBd").parents(".zDropdown"))}).off("click",".zSlcWrap>input.zIpt").on("click",".zSlcWrap>input.zIpt",function(a){a.stopPropagation();var b=$(this);if(b.data("zTarget")&&b.data("zTarget").length>0)return void d.remove();d.remove();var c=b.parent(),e=c.prev(".zSlc"),f=$('<div class="zSlcBd"></div>');b.data("showFilter")&&f.append('<div class="zFilter"><input type="text" class="zIpt w" /></div>').addClass("zSlcHasFilter"),e.find("option, optgroup").each(function(){var a=$(this),b=$('<p data-val="'+a.attr("value")+'" class="'+a.attr("class")+'" style="'+a.attr("style")+'">'+a.html()+"</p>").appendTo(f);"OPTGROUP"===this.nodeName?b.removeAttr("data-val").attr("disabled","disabled").attr("slcGroup","true").html(a.attr("label")):(a.attr("disabled")&&b.attr("disabled",a.attr("disabled")),a[0].selected&&b.attr("selected",a[0].selected?"selected":""))}),d.show(b,"",f[0].outerHTML);var g=b.data("zTarget");g.focus(),g.on("keydown",function(a){return 65==a.keyCode&&(a.ctrlKey||a.metaKey)?(g.find(".zSlcBd>p").trigger("click"),!1):void 0})}).off("click",".zSlcBd").on("click",".zSlcBd",function(a){a.stopPropagation()}).off("input",".zSlcBd>.zFilter>.zIpt").on("input",".zSlcBd>.zFilter>.zIpt",function(){var a=this.value.toUpperCase();slcBd=$(this).parents(".zSlcBd");for(var b=slcBd.find(">p").hide(),c=0;c<b.length;c++){var d=$(b[c]);(d.attr("disabled")||-1!==d.html().toUpperCase().indexOf(a))&&d.show()}}).off("click",".zSlcBd>p").on("click",".zSlcBd>p",function(a){a.stopPropagation();var b=$(this);if(!b.attr("disabled")){var c=$(this).parents(".zDropdown").data("zTarget"),e=c.parent().prev(".zSlc"),g=b.attr("data-val"),h=e.find('option[value="'+g+'"]');if(g&&h.length||(g=b.text(),h=e.find('option:contains("'+g+'")').filter(function(){return this.innerText==g})),e.attr("multiple")){b.attr("selected")?(b.removeAttr("selected"),h[0].selected=!1,h.prop("selected",!1)):(b.attr("selected","selected"),h[0].selected=!0,h.prop("selected",!0));var i=f(e).join(", ");c.val(i||""),c.change(),e.change()}else c.val(h.text()),e.find("option").attr("selected",!1),h.prop("selected",!0),d.remove(c),c.change()}})})};h(),b.exports=e},{"./dropdown":8}],16:[function(a,b,c){var d=function(a,b){this.container=b,this.dataList=a;var c=this;c._render=function(){var a=$('<aside class="zSideBar"><ul class="zSideBarUl"></ul></aside>'),d=a.find("ul");c.dataList.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");if(b.appendTo(d),a.hash&&b.find(">a").attr("href",a.hash),a.children){b.addClass("hasMore").append("<ul></ul>");var c=b.find("ul");a.children.map(function(a){var b=$("<li><a>"+a.name+"</a></li>");b.appendTo(c),a.hash&&b.find(">a").attr("href",a.hash)})}}),a.appendTo($(b))},c._render()};b.exports=d},{}],17:[function(a,b,c){var d=a("./toolsDojo"),e=function(){this.pageNo=1,this.pageSize=10,this.sortKey,this.sortUp,this.showPager=!0,this.hasNext,this.showSearchBox=!1,this.exportFile="",this.showBtnExport=!1,this.showCheckbox=!1,this.total=null,this.originDataList=null,this.dataList=null,this.filterDataList=null,this.pageData,this.tdDataList=null,this.filterTdDataList=null,this.ajaxCallback,this.afterLoad,this.table=$('<table class="table ocTable"></table>'),this.headMapping={id:{text:"ID",width:50,sort:!0},name:{text:"姓名",width:100,sort:!0,"export":!1},department:"部门",sex:"性别",param1:{text:"参数1",width:100}};var a=this;a.load=function(b,c){a.table.removeClass("zLoadingCover"),"number"==typeof c&&(a.total=c),"boolean"==typeof c&&(a.hasNext=c),a.originDataList=$.extend(!0,[],b),a.filterDataList=a.dataList=$.extend(!0,[],b);var d=a._renderBody();if(a.table.find("tbody").replaceWith(d),a.showPager){var e=a._renderFoot();a.table.find("tfoot").replaceWith(e)}else a.table.find("tfoot").remove();a.filterDataList=a.dataList,a.afterLoad&&a.afterLoad()},a.loading=function(){a.dataList=a.filterDataList=null,a.table.find("tbody").html('<tr><td colspan="100"><i class="zLoadingIcon"></i> Loading ...</td></tr>')},a._renderCaption=function(){var a=$("<caption></caption>");return this.showBtnExport&&a.append('<button type="text" class="btnExport btn btn-gray btn-sm fr" style="margin-bottom: 5px;">Export</button>'),this.showSearchBox&&a.append('<label class="form-inline w200"><input type="text" class="searchBox form-control input-sm" placeholder="Search here ..." /></label>'),a},a._renderHead=function(){var b=$("<thead><tr></tr></thead>"),c=b.find("tr");a.showCheckbox&&c.append('<th style="width: 40px"><input class="cbxOcTable" type="checkbox" /></th>');for(var d in a.headMapping){var e=a.headMapping[d],f=e.text;void 0===f&&(f=d);var g=$("<th>"+f+"</th>");e.sort&&g.attr("data-sort",d),e["export"]===!1&&g.attr("data-export",!1),e.width&&g.css("width",e.width+"px"),c.append(g)}return b},a._getDefault=function(a){return void 0===a||null===a?"":a},a._getVal=function(a,b){var c=b.split("."),d=a[b];if(c.length>1){d=a;for(var e=0;e<c.length&&(d=d[c[e]],d);e++);}return d},a.renderTr=function(b){var c=$("<tr></tr>");for(var d in a.headMapping){var e=(d.split("."),a._getVal(b,d));c.append("<td>"+a._getDefault(e)+"</td>")}return c},a.filter=function(b){b&&"function"==typeof b&&(a.filterDataList=a.dataList.filter(function(a){return b(a)}),a.pageNo=1,a._reloadBody(),a._reloadFoot())},a._buildTdData=function(){a.dataList=a.dataList.map(function(b){return a._setTrModel(b),b})},a._setTrModel=function(b){var c={},d=a.renderTr(b),e=d.find(">td"),f=0;for(var g in a.headMapping){var h=$(e[f]).text();/^[1-9][0-9]*(\.)?[0-9]*$/.test(h)&&(h=parseFloat(h)),c[g]=h,f++}b.trModel=c},a._getValByMappingKey=function(b,c){var d=a._getVal(b,c),e=a._getDefault(d);return e},a._getPageData=function(){if(a.total||"boolean"==typeof a.hasNext)return a.dataList;var b=a.pageSize*(a.pageNo-1),c=a.filterDataList;if(a.showPager){var d=a.pageSize>c?c.length:a.pageSize;a.pageData=a.filterDataList.slice(b,d+b)}else a.pageData=a.filterDataList;return a.pageData},a._renderBody=function(){var b=$("<tbody></tbody>");if(!a.filterDataList)return b.append('<tr><td colspan="100"><i class="zLoadingIcon"></i> Loading ...</td></tr>'),b;if(a.filterDataList.length){a.pageData=a._getPageData();for(var c=0;c<a.pageData.length;c++){var d=a.pageData[c],e=a.renderTr(d);a.showCheckbox&&e.prepend('<td><input type="checkbox" class="cbxOcTable"></td>'),b.append(e)}}else a.pageData=[],b.append('<tr class="trEmpty"><td colspan="100">No data</td></tr>');return b},a._renderFoot=function(){a.pageNo?a.pageNo=parseInt(a.pageNo):a.pageNo=1,a.pageSize&&(a.pageSize=parseInt(a.pageSize));var b=$('<tfoot><tr><td colspan="100"><form><nav><ul class="pagination"></ul></nav></form></td></tr></tfoot>'),c=b.find("nav"),d=b.find("ul");if(!a.dataList||0==a.dataList.length)return b;if(void 0!==a.hasNext){var e=$('<li><a href="#" title="Previous" data-page="'+(a.pageNo-1)+'">Prev</a></li>').appendTo(d),f=$('<li><a href="#" title="Next" data-page="'+(a.pageNo+1)+'">Next</a></li>').appendTo(d);a.hasNext||f.addClass("disabled"),1==a.pageNo&&e.addClass("disabled"),c.parent().prepend('<span class="form-inline pr" style="top: 5px">Current page '+a.dataList.length+' items, show <input type="number" name="pageSize" class="form-control w40" min="1" max="2000" value="'+a.pageSize+'" title="1 ~ 2000之间的整数" /> rows each page.')}else{d.append('<li><a href="#" title="First" data-page="1">&laquo;</a></li>'),d.append('<li><a href="#" title="Previous" data-page="'+(a.pageNo-1)+'">‹</a></li>');var g=a.total||a.filterDataList.length,h=parseInt(g/a.pageSize);h*a.pageSize<g&&h++;var i=a.pageNo-2;1>i&&(i=1);var j=i+4;for(j>h&&(j=h,i=j-4,1>i&&(i=1));j>=i;){var k=$('<li><a href="#" data-page="'+i+'">'+i+"</a></li>").appendTo(d);i===a.pageNo&&k.addClass("active"),i++}if(d.append('<li><a href="#" title="Next" data-page="'+(a.pageNo+1)+'">›</a></li>'),d.append('<li><a href="#" title="Last" data-page="'+h+'">&raquo;</a></li>'),1===a.pageNo&&d.find("li:lt(2)").addClass("disabled"),a.pageNo===h||0===h){var l=d.find("li:last-child").addClass("disabled");l.prev().addClass("disabled")}c.parent().prepend('<span class="form-inline pr" style="top: 5px">Total '+g+" rows in "+h+' pages, show <input type="number" name="pageSize" class="form-control w40" min="1" max="2000" value="'+a.pageSize+'" title="1 ~ 2000之间的整数" /> rows each page.'),c.append('<span class="form-inline"><input type="number" name="pageNo" class="form-control w40" min="1" max="'+h+'" /><button class="btn btn-default" type="submit">GO</button></span>')}return b},a._render=function(){var b=a._renderCaption(),c=a._renderHead(),d=a._renderBody(),e=a._renderFoot();a.table.html("").off("click"),a.table.append(b),a.table.append(c),a.table.append(d),a.table.append(e),a._bindEvents()},a.placeAt=function(b){var b=$(b);d.destroyByNode(b[0]),b.html(""),a._render(),a.table.appendTo(b)},a._reloadBody=function(){a.table.removeClass("zLoadingCover");a.table.find("tbody").replaceWith(a._renderBody());a.afterLoad&&a.afterLoad()},a._reloadFoot=function(){a.table.find("tfoot").replaceWith(a._renderFoot())},a._loadData=function(){a.pageNo||(a.pageNo=1),a.table.addClass("zLoadingCover");var b={pageNo:a.pageNo,pageSize:a.pageSize};a.sortKey&&(b.orderBy=a.sortKey,b.desc=a.sortUp?"asc":"desc"),a.ajaxCallback&&a.ajaxCallback(b,function(b){a.dataList=b,a.pageNo||(a.pageNo=1),a._reloadBody(),a._reloadFoot()})},a["export"]=function(){var a=this._renderExport(),b=document.createElement("form");b.id="tempForm1",b.method="post",b.action="/product/owerp/util/csv.jsp",b.charset="UTF-8";var c=document.createElement("input");c.type="hidden",c.name="name",c.value=this.exportFile+".csv",b.appendChild(c);var d=document.createElement("input");d.type="hidden",d.name="content",d.value=a,b.appendChild(d),document.body.appendChild(b),b.submit(),document.body.removeChild(b)},a._renderExport=function(){var b="<table>",c=this._renderHead();b+=c[0].outerHTML;var d=$("<tbody></tbody>");a.filterDataList.map(function(b){d.append(a.renderTr(b)[0])}),b+=d[0].outerHTML,b+="</table>",table=$(b),table.find('[data-export="false"]').each(function(){var a=$(this).index();table.find("thead tr th:eq("+a+")").remove(),table.find("tbody tr").find("td:eq("+a+")").remove()});var e=table.html();return e=e.replace(/(<thead[^>]*>)|(<tbody[^>]*>)|(<\/thead>)|(<\/tbody>)|(<tr[^>]*>)/g,""),e=e.replace(/(<th[^>]*>)|(<td[^>]*>)/g,'"'),e=e.replace(/(<\/th>)|(<\/td>)/g,'	",'),e=e.replace(/,<\/tr>/g,"\n"),e=e.replace(/(<[^>]*>)|(<\/[^>]*>)/g,"")},a._bindFootEvents=function(){a.table.on("click","tfoot .pagination li a",function(b){b.preventDefault();var c=$(this);if(!c.parent().hasClass("active")&&!c.parent().hasClass("disabled")){if(a.pageNo=parseInt(c.attr("data-page")),a.total||"boolean"==typeof a.hasNext)return void a._loadData();a._reloadBody(),a._reloadFoot()}}).on("click","thead th[data-sort]",function(){if(a.dataList){var b=$(this);b.parent().find("th").not(b).removeClass("sortUp").removeClass("sortDown");var c=b.attr("data-sort"),d=!0;if(b.hasClass("sortUp")?(b.removeClass("sortUp").addClass("sortDown"),d=!1):b.removeClass("sortDown").addClass("sortUp"),a.pageNo=1,a.total||"boolean"==typeof a.hasNext)return a.sortKey=c,a.sortUp=d,void a._loadData();a.filterDataList.sort(function(b,e){var f,g;return b.trModel?(f=b.trModel[c],g=e.trModel[c]):(f=a._getValByMappingKey(b,c),g=a._getValByMappingKey(e,c)),"number"==typeof f?d?f-g:g-f:d?f.toString().localeCompare(g):g.toString().localeCompare(f)}),a._reloadBody()}}).on("submit","tfoot form",function(){var b=a.table.find("tfoot form");return a.pageSize=parseInt(b.find('input[name="pageSize"]').val()),a.pageNo=parseInt(b.find('input[name="pageNo"]').val()||1),a.total||"boolean"==typeof a.hasNext?(a._loadData(),!1):(a._reloadBody(),a._reloadFoot(),!1)})},a.search=function(b){a.dataList&&a.dataList.length&&(a.dataList[0].trModel||a._buildTdData(),a.pageNo=1,a.filterDataList=a.dataList.filter(function(a){var c=!1,d=a.trModel;for(var e in d)if(-1!==d[e].toString().toUpperCase().indexOf(b)){c=!0;break}return c}),a._reloadBody(),a._reloadFoot())},a._bindEvents=function(){a.table.off("input").on("input","caption .searchBox",function(){var b=$.trim(this.value).toUpperCase();a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.search(b)},500)}).off("click").on("click","thead input:checkbox.cbxOcTable",function(){var b=this.checked;a.table.find("tbody input:checkbox.cbxOcTable").each(function(){$(this).prop("checked",b).change()})}).on("click","tbody input:checkbox.cbxOcTable",function(){a.table.find("thead input:checkbox.cbxOcTable").prop("checked",!1).change()}).on("click","caption .btnExport",function(){a["export"]()}),a._bindFootEvents()}};b.exports=e},{"./toolsDojo":18}],18:[function(a,b,c){var d={};d.destroyByNode=function(a){if(a&&a.children&&a.children.length&&window.dojo&&dojo.dijit&&dojo.dijit.registry){var b=dojo.dijit.registry.byNode(a.children[0]);b&&(b.destroyDescendants(),b.destroyRecursive())}},b.exports=d},{}],19:[function(a,b,c){var d=a("./dialog"),e={};e.loadingButton=function(a,b){a=$(a),"BUTTON"!==a[0].nodeName&&(a=a.find('button[type="submit"]:eq(0)'));var c=a.html();a.html('<i class="zLoadingIcon"></i>').attr("data-html",c),b||a.attr("disabled","disabled")},e.resetButton=function(a){a=$(a),"BUTTON"!==a[0].nodeName&&(a=a.find('button[type="submit"]:eq(0)'));var b=a.attr("data-html");a.removeAttr("disabled").html(b)},e.validity=function(a){a=$(a);try{-1==="INPUT,TEXTAREA,SELECT".indexOf(a[0].nodeName.toUpperCase())&&(a=a.find("input, textarea, select").filter(":visible"));var b=!0;return a.each(function(){var a=this.validity;if(!a.valid){b=!1;var c="";return c=this.title?this.title:this.validationMessage?this.validationMessage:a.customError?"Custome validity is not pass.":a.patternMismatch?"Format is not creact":a.rangeOverflow?"Value is to large":a.rangeUnderflow?"Value is to small":a.stepMisMatch?"Not allowed value":a.tooLong?"Value is too long":a.typeMismatch?"Value is not matched":a.valueMissing?"Value is required":"Format is not creact",d.warn(c,this),this.focus(),!1}}),b}catch(c){return console.log("validity错误：",c),!0}},e.getValueByParam=function(a,b){if(-1===b.indexOf("."))return a[b];b=b.split(".");for(var c=a,d=0;d<b.length;d++){var e=b[d];if(c=c[e],void 0===c)return void 0}return c},e.fill=function(a,b){a=$(a);var c=a.find("input[name]:visible, select[name]:visible, textarea[name]:visible");c.each(function(){var a=this.name,d=e.getValueByParam(b,a)||"";if("radio"==this.type)c.filter('[name="'+a+'"]').prop("checked",!1),c.filter('[name="'+a+'"][value="'+d+'"]').prop("checked",!0);else if("checkbox"==this.type){var f=this.value;d==f||d&&d.indexOf&&-1!==d.indexOf(f)?this.checked=!0:this.checked=!1}else $(this).val(d)})},e.setValueByParam=function(a,b,c,d){var e=null;if(-1===b.indexOf("."))!a[b]||d?a[b]=c:(a[b]=a[b]instanceof Array?a[b]:[a[b]],a[b].push(c));else{b=b.split(".");for(var e=a,f=0;f<b.length-1;f++){var g=b[f];e[g]||(e[g]={}),e=e[g]}arguments.callee.call(this,e,b.slice(-1)[0],c,d)}},e.getJson=function(a,b){var a=$(a),c={},d=a.find("input[name]:visible, select[name]:visible, textarea[name]:visible");return d.each(function(){var a=this.name,d=this.value;"checkbox"==this.type?this.checked&&e.setValueByParam(c,a,d):"radio"===this.type?this.checked&&e.setValueByParam(c,a,d,!0):(!b||d)&&e.setValueByParam(c,a,d,!0)}),c},b.exports=e},{"./dialog":7}],20:[function(a,b,c){var d={};d.toFixed=function(a,b){return a&&a.toFixed?0===a||"0"===a?0:a.toFixed(b||2):""},d.formatMoney=function(a,b){return"number"!=typeof a&&(a=parseFloat(a)),0==a?0:(b&&(a=a.toFixed(b)),a.toString().split("").reverse().join("").replace(/(\d{3}(?=\d)(?!\d+\.|$))/g,"$1,").split("").reverse().join(""))},b.exports=d},{}],21:[function(a,b,c){var d={},e=function(a){var b=a.next(".zTableFixHead");b.find("thead tr").each(function(b){var c=$(this),d=a.find("tr:eq("+b+")");c.find("th").each(function(a){var b=$(this),c=d.find("th:eq("+a+")");b.css("width",c.outerWidth())})})},f=function(a){var b=a.next(".zTableFixHead");a.parent().scrollTop(0);var c=a.position();b.css({position:"absolute",left:c.left,width:a.width(),top:c.top})},g=function(a){var b=a.next(".zTableFixHead");b.css({left:a.position().left})};d.fixHead=function(a){a=$(a),a.each(function(){var b=$(this);b.next(".zTableFixHead").remove(),newTable=$(this).clone().addClass("zTableFixHead"),newTable.find("tbody, tfoot").remove();b.find("thead");b.after(newTable),e(b),f(b),b.parent().on("scroll",function(){if(b)clearTimeout(b);else var b=setTimeout(function(){a.each(function(){var a=$(this);g(a)})},100)})}),$(window).on("resize",function(){if(b)clearTimeout(b);else var b=setTimeout(function(){a.each(function(){var a=$(this);e(a),f(a)})},100)})},b.exports=d},{}],22:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null,this.addClickCallback=null,this.editClickCallback=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),$(this.config.container).find(".zTree").remove(),$(this.config.container).append(c.ele),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeTag"))}))},c.removeFilterTag=function(){c.ele.find(".treeTag").removeClass("treeTag")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description).append('<span class="spanDesc"> - '+h.description+"</span>"),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){$(this).parent().toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2 none"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();if(!e||!e.id)return void b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()});var f=b.data().id;c.deleteNode(f,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent();b.addClass("zTreeEdit"),b.html('<input type="text" name="name" placeholder="name" maxLength="250"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i>');var d=b.parent().data();b.find('[name="name"]').val(d.name),b.find('[name="description"]').val(d.description),c.editClickCallback&&c.editClickCallback(b)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this);b.removeClass("icon-checkmark").addClass("zLoadingIcon");var d=b.parents(".zTreeItem:eq(0)").removeClass("zTreeItemDes"),e=d.data();if(!e||!e.id){e={};var f=d.parents(".zTreeItem:eq(0)").data();e.fid=f.id,e.level=parseInt(f.level)+1}e.name=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val();var g=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),d.data(e).find(">p").html(e.name).removeClass("zTreeEdit zTreeAdd"),void(e.description&&d.addClass("zTreeItemDes").find(">p").attr("title",e.description).append('<span class="spanDesc"> - '+e.description+"</span>")))};e.id?c.updateNode(e,g):c.addNode(e,g)}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),d=b.find(">ul");0===d.length&&(d=$("<ul></ul>").appendTo(b));var e=$('<li class="zTreeItem"></li>');e.append('<p class="zTreeEdit zTreeAdd"><input type="text" name="name" placeholder="name" maxLength="250"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark"></i></p>'),e.appendTo(d),c.addClickCallback&&c.addClickCallback(a)}).on("dragstart",".zTreeItem[draggable]",function(a){a.stopPropagation(),c.dragEle=$(this),a.originalEvent&&a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.setData("dragEle",a.target)}).on("dragenter",".zTreeItem>p",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=b.parent(),e=c.dragEle.data(),f=d.data(),g=e.id,h=f.id;(h!=g||e.level!=f.level)&&(d.data().fid==c.dragEle.data().fid||h==c.dragEle.data().fid)&&d.addClass("treeTag")}).on("dragleave",".zTreeItem>p",function(a){c.timer&&clearTimeout(c.timer),a.stopPropagation(),$(this).parent().removeClass("treeTag")}).on("dragover",".zTreeItem.treeTag",function(a){a.preventDefault()}).on("drop",".zTreeItem.treeTag",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;d.fid==g&&(g=0),c.moveNode(f,g,function(a,d){b.removeClass("treeTag"),a?0==g?b.find(">ul").prepend(c.dragEle):c.dragEle.insertAfter(b):oc.dialog.tips(d)}),a.stopPropagation(),a.preventDefault()})},c.moveNode=function(a,b,c){c(!0)},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){setTimeout(b,2e3)},c.render()};b.exports=d},{}],23:[function(a,b,c){var d=function(a,b){this.ele=$(a),this.valueChangeHanlder=null,this.dialogPanel=$('<div class="treeDialogSelect"></div>'),this.dataList=b,this.productLine=null,this.keyword="",this.canSelectedFolder=!1;var c=this;c._render=function(){c.dialogPanel.append('<div class="borderBottom pb10 pl10"><span style="padding-right:58px;">Search:</span><input id="txtKeyword" type="text" class="ipt w200"><span class="ml20 f12 spanInfo" style="color:#888"><i class="icon-info mr5" style="color:#eea236;"></i>eg:Search to the items and it\'s children. </span></div>'),c.canSelectedFolder&&c.dialogPanel.find(".spanInfo").append(" Double click to select the folder.");for(var a=$('<ul class="ulResposible ulData"><li class="liTitle">Resposibles:</li></ul>'),b=[],d=0;d<c.dataList.length;d++){var e=c.dataList[d],f=$('<li class="liFolder">'+e.name+"</li>").data(e);f.appendTo(a),e.items&&e.items.map(function(a){var c=a.description;if(!c)return!0;for(var d=c.split(/[\s|,]/g),e=0;e<d.length;e++)-1===$.inArray(d[e],b)&&b.push(d[e])})}b.sort();var g=$('<ul class="ulProductLine"><li class="liTitle">Product Lines:</li></ul>');b.map(function(a){g.append("<li>"+a+"</li>")}),c.productLine&&g.find("li:contains("+c.productLine+")").addClass("active"),g.appendTo(c.dialogPanel),a.appendTo(c.dialogPanel),c._bindEvents()},c._setSelected=function(){var a=c.ele.data("selectedList");a&&a.length>0&&a.map(function(a){var b=$(".zDialog .ulData:last"),d=b.find("li:eq("+a.eleIndex+")").addClass("active");c._renderChild(b,d)})},c._renderChild=function(a,b){var d=b.data();if(d.items&&d.items.length){var e=$('<ul class="ulData"><li class="liTitle">Children:</li></ul>');d.items.map(function(b){var d=$('<li title="'+b.name+'">'+b.name+"</li>").data(b);b.items&&0!==b.items.length?d.addClass("liFolder"):d.addClass("liData"),e.append(d),c.productLine&&a.hasClass("ulResposible")&&b.description&&-1===b.description.indexOf(c.productLine)&&d.hide()}),a.after(e),d.items&&d.items.length>0&&c._needFilter(b)&&c.filter(e.find("li"))}},c._needFilter=function(a){var b=a.parent().prevAll(".ulData").find("li.active");b=a.add(b);var d=!1;return b.each(function(){var a=$(this),b=a.data(),e=b.name.toUpperCase();return b.description&&c.productLine&&-1===b.description.indexOf(c.productLine)?!0:c.keyword&&0!==e.indexOf(c.keyword)?!0:(d=!0,!1)}),!d},c._bindEvents=function(){c.ele.off("click").on("click",function(){c.dialogPanel.html(""),c._render(),c.keyword=null,oc.dialog.open("",c.dialogPanel,function(){c._setSelected()}),c.dialogClickHanlder()})},c.filter=function(a){a||(a=$("ul.ulData li")),a.each(function(){var a=$(this).show();if(a.hasClass("liTitle"))return!0;var b=a.data();if(b.description){var d=c.productLine.split(";");if(d.length>1){var e=!1;if(d.map(function(a){a=$.trim(a),a&&-1!==b.description.indexOf(a)&&(e=!0)}),e===!1)return a.hide(),!0}else if(c.productLine&&-1===b.description.indexOf(c.productLine))return a.hide(),!0}var f=b.name.toUpperCase();c.keyword&&0!==f.indexOf(c.keyword)&&(c.filterChildren(b.items)||a.hide())})},c.filterChildren=function(a){var b=!1,d=function(a){if(!a||0===a.length)return b;if(b===!0)return b;for(var e=0;e<a.length;e++){if(b===!0)return!0;var f=a[e],g=!0,h=f.name.toUpperCase();if(f.description&&c.productLine&&-1===f.description.indexOf(c.productLine)?g=!1:c.keyword&&0!==h.indexOf(c.keyword)&&(g=!1),g===!0)return b=!0,!0;d(f.items)}};return d(a),b},c.selectedHanlder=function(a){var b=$(this);if(!b.hasClass("liFolder")||c.canSelectedFolder){var d=b.data();d.eleIndex=b.index(),c.ele.data("selectedItem",d);var e=b.parent(),f=[];e.prevAll("ul.ulData").each(function(){var a=$(this).find("li.active");a.data().eleIndex=a.index(),f.push(a.data())}),f.reverse(),f.push(d),c.ele.data("selectedList",f),c.ele.val(this.innerHTML),oc.dialog.close()}},c.dialogClickHanlder=function(){$(".zDialog").on("click","li.liFolder",function(){var a=$(this),b=a.parent();b.find(".active").removeClass("active"),a.addClass("active"),b.nextAll(".ulData").remove(),c._renderChild(b,a)}).on("dblclick","li.liFolder",c.selectedHanlder).on("click","li.liData",c.selectedHanlder).on("click",".ulProductLine li:gt(0)",function(){var a=$(this);return a.hasClass("active")?(a.removeClass("active"),c.productLine=null,void $(".zDialog .ulData:eq(1) li").show()):(a.parent().find(".active").removeClass("active"),a.addClass("active"),c.productLine=a.html(),void c.filter())}).on("input","#txtKeyword",function(){c.keyword=$.trim(this.value).toUpperCase(),c.filter()})},c.setSelectedByIds=function(a){var b=[],d=null;a&&a.length||c.ele.html("");for(var e=$.extend([],c.dataList),f=0;f<a.length;f++){var g=a[f];if(!g)break;for(var h=null,i=0;i<e.length;i++){var j=e[i];if(j.id==g){h=j;break}}if(!h)break;h.eleIndex=i+1,e=$.extend([],h.items),b.push(h),d=h}var k="";d&&(k=d.name),c.ele.data("selectedList",b),c.ele.data("selectedItem",d),c.ele.val(k)},c._render()};b.exports=d},{}],24:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,teamData:null,showLevel:1,family:null,allUser:null,isShowAdmin:!1},this.allUserName=null,this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.config.allUser&&(c.allUserName=[],c.config.allUser.map(function(a){c.allUserName.push(a.fullName)})),c.render=function(){c.ele=$('<ul class="zTree zTreeOrganization"></ul>');var a=$('<li class="zTreeItem zTreeItemFolder"><p><span class="pName">海翼电商</span></p></li>');
a.appendTo(c.ele),c._renderRecusive(c.config.data.children,a,0),c.ele.find(">li>ul>li").removeAttr("draggable"),c.ele.appendTo($(this.config.container)),c.resetShowName(),c._bindEvents()},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true" data-type="'+h.nodeType+'"><p><span class="pName">'+h.name+"</span></p></li>");30===h.nodeType&&i.removeAttr("draggable"),10==h.nodeType||1==h.nodeType||2==h.nodeType?i.addClass("zTreeItemFolder"):21==h.nodeType&&i.addClass("zTreeItemReport"),0!==h.status&&i.find("p").addClass("lineThrough"),h.childrenCount&&21===h.nodeType&&i.find("p").append('<span class="treeCount">'+h.childrenCount+"</span>"),!h.userCount||1!==h.nodeType&&2!==h.nodeType||i.find("p").append('<span class="treeCountMember">'+h.userCount+"</span>"),i.appendTo(f).data(h),h.children&&h.children.length>0&&c._renderRecusive(h.children,i,d+1)}e>0&&f.appendTo(b)}},c.resetShowName=function(){c.ele.find("li.zTreeItem>p").each(function(){var a=$(this),b=a.parent(),d=b.data();if(!d||!d.nodeType)return!0;var e=d.nodeType;if(10===e){var f=d.name,g=c.config.teamData.filter(function(a){return a.id==f});0==g.length?b.html('<p><span class="pName">未知部门</span></p>'):(g=g[0],d.addOn=g,a.find(".pName").html(g.name))}else if(21===e||11===e){var h=b.data().name,i=c.config.allUser.filter(function(a){return a.name==h});i.length>0&&(d.addOn=i[0],a.find(".pName").html(i[0].fullName))}})},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p>.pName").text().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeSearch"))}))},c.removeFilterTag=function(){c.ele.find(".treeSearch").removeClass("treeSearch")},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){var a=$(this).parent();a.toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){$('<span class="zTreeControl"><i class="icon-plus2"></i><i class="icon-cog"></i><i class="icon-minus2"></i></span>').hide().appendTo(this).fadeIn(1e3)}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-minus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)"),d=b.parent(),e=b.data();c.deleteNode(e,function(){b.fadeOut(500,function(){b.remove(),0===d.find(".zTreeItem").length&&d.remove()})})}).on("click",".icon-cog",function(a){a.stopPropagation();var b=$(this).parent().parent(),d=b.parent(),e=d.data();c.model=e,c.dialogEdit(d)}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-plus2",function(a){a.stopPropagation();var b=$(this).parents(".zTreeItem:eq(0)").addClass("active");c.model=null,c.parentModel=b.data(),c.dialog(b)}).on("dragstart",".zTreeItem[draggable]",function(a){a.stopPropagation(),c.dragEle=$(this),a.originalEvent&&a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.setData("dragEle",a.target)}).on("dragenter","ul",function(a){a.stopPropagation(),a.preventDefault()}).on("dragenter",".zTreeItemFolder>p>span, .zTreeItemReport>p>span",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=b.parents("li:eq(0)"),e=c.dragEle.data(),f=d.data(),g=e.id,h=f.id;if(g!=h&&!d.hasClass("zTree")&&h!=c.dragEle.parents("li:eq(0)").data().id&&f.familyName==e.familyName){var i=d.parents("li"),j=!0;i.each(function(){var a=$(this).data().id;a==g&&(j=!1)}),j&&(d.addClass("treeTag"),c.timer=setTimeout(function(){d.addClass("active")},1500))}}).on("dragenter",".zTreeItem",function(a){a.stopPropagation(),a.preventDefault();var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;if(f!=g&&e.familyName==d.familyName){var h=c.dragEle.parents("li:eq(0)").data().id;(h===b.parents("li:eq(0)").data().id||h==g)&&b.addClass("treeTagSort")}}).on("dragleave",".zTreeItem",function(a){a.stopPropagation();var b=$(this);b.removeClass("treeTagSort")}).on("dragleave",".zTreeItem>p>span",function(a){a.stopPropagation(),c.timer&&clearTimeout(c.timer);var b=$(this).parents("li:eq(0)");b.hasClass("treeTag")&&b.removeClass("treeTag")}).on("dragover",".zTreeItem",function(a){a.preventDefault()}).on("drop",".zTreeItemFolder.treeTag, .zTreeItemReport.treeTag",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;c.moveNode(f,g,function(a,e){if(b.removeClass("treeTag"),a){var f=b.find(">ul");0==f.length&&(f=$("<ul></ul>").appendTo(b)),b.addClass("hasMore");var h=c.dragEle.parents("ul:eq(0)");d.parentId=g,c.dragEle.data(d),c.dragEle.appendTo(f),0===h.find("li").length&&(h.parent().removeClass("hasMore"),h.remove())}else oc.dialog.tips(e)}),a.stopPropagation(),a.preventDefault()}).on("drop",".zTreeItem.treeTagSort",function(a){var b=$(this),d=c.dragEle.data(),e=b.data(),f=d.id,g=e.id;c.dragEle.parents("li:eq(0)").data().id==g&&(g=null),c.sortNode(f,g,function(a,d){b.removeClass("treeTagSort"),a?null==g?b.find(">ul").prepend(c.dragEle):c.dragEle.insertAfter(b):oc.dialog.tips(d)}),a.stopPropagation(),a.preventDefault()})},c.dialogEdit=function(a){var b='<div class="formOrganization"><p class="mt10 divPerson"><span>Name: </span><input type="text" class="form-control input-sm" name="name" autocomplete="off" value="'+a.find(">p>.pName").text()+'"></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Save</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>';10===c.model.nodeType&&(b='<div class="formOrganization"><a class="jsAddTeam" href="#">Add a team</a><p class="mt10 divGroup"><span class="mt10">Name: </span><select class="slcDepartmentType form-control input-sm" name="departmentType" style="width:120px !important"></select><select class="slcDepartment form-control input-sm" name="name" style="width:280px !important"></select></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Save</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>'),oc.dialog.open("Edit",b);var d=$(".zDialog");if(10===c.model.nodeType){var e=d.find('[name="name"]'),f=d.find('[name="departmentType"]');c.config.teamData.map(function(a){e.append('<option value="'+a.id+'">'+a.name+"</option>"),a.type&&0===f.find('option:contains("'+a.type+'")').length&&f.append("<option>"+a.type+"</option>")}),e.find('option[value="'+c.model.name+'"]').attr("selected",!0),f.find('option:contains("'+c.model.addOn.type+'")').attr("selected",!0),f.on("change",function(){e.html("");var a=this.value;c.config.teamData.map(function(b){b.type==a&&e.append('<option value="'+b.id+'">'+b.name+"</option>")})})}if(1!==c.model.nodeType&&2!==c.model.nodeType)oc.ui.autoComplete(d.find('[name="name"]'),c.allUserName);else{var g=$('<p><span class="w100">Forbid Team:</span><input type="checkbox" name="forbidTeam" class="zToggleBtnSm"></p><p class="mb10"><span class="w100">Allow Dup:</span><input type="checkbox" name="allowDup" class="zToggleBtnSm"></p>');d.find(".divPerson").prepend(g),d.find('[name="forbidTeam"]').prop("checked",1===c.model.forbidTeam),d.find('[name="allowDup"]').prop("checked",1===c.model.allowDup),oc.ui.toggleBtn("YES","NO")}d.on("click",".btnSub",function(){var b=$(this);if(!c.checkDialogName(d))return!1;var e=null;if(21===c.model.nodeType||11===c.model.nodeType?(e=c.getUserByFullName(c.model.name),c.model.name=e.name):10===c.model.nodeType&&(e=c.getTeamById(c.model.name)),b.html('<i class="zLoadingIcon mr5"></i>').attr("disabled",!0),1===c.model.nodeType||2===c.model.nodeType){c.model.forbidTeam=$('[name="forbidTeam"]').prop("checked")?1:0,c.model.allowDup=$('[name="allowDup"]').prop("checked")?1:0;var f={familyName:c.model.familyName,name:c.model.name,forbidTeam:c.model.forbidTeam,allowDup:c.model.allowDup};return void oc.ajax.put("/product/rest/v1/user_groups/family",f,function(b){oc.dialog.close(),c.model.name=f.name,c.model.forbidTeam=f.forbidTeam,c.model.allowDup=f.allowDup,a.find(">p>.pName").html(c.model.name).data(c.model)},function(a){oc.dialog.tips("Edit node fail:"+a.responseText),b.removeAttr("disabled").html("Save")})}var f=$.extend(c.model,{});f.type&&delete f.type,f.addOn&&delete f.addOn,c.updateNode(c.model,function(d,f){if(d){oc.dialog.close(),c.model.addOn=e;var g=a.find(">p>.pName").html(e.fullName||e.name);e.img&&g.parent().addClass("pImg").append('<img src="'+img+'" />'),a.data(c.model)}else b.removeAttr("disabled").html("Save"),oc.dialog.tips("Edit node fail:"+f)})}).on("click",".jsAddTeam",function(b){b.preventDefault(),c.showTeamPanel(function(b){c.dialogEdit(a),$(".zDialogCover .slcDepartment").val(b.id),$(".zDialogCover .departmentType").val(b.type)})})},c.checkDialogName=function(a){var b=this,c=a.find('[name="name"]:visible');return b.model.name=$.trim(c.val()),b.model.name?!0:(oc.dialog.tips("Name is required"),c.focus(),!1)},c.getUserByFullName=function(a){var b=c.config.allUser.filter(function(b){return b.fullName==a});return b.length>0?b[0]:null},c.getTeamById=function(a){var b=c.config.teamData.filter(function(b){return b.id==a});return b.length>0?b[0]:null},c.dialog=function(a){var b='<div class="formOrganization"><a class="jsAddTeam" href="#">Add a team</a><div class="p15"><p class="pType"><span>Type: </span><label class="mr30"><input type="radio" name="addType" value="person" checked style="margin-right:5px">人员</label><label><input name="addType" style="margin-right:5px" type="radio" value="group">团队</label></p><p class="mt10 divPerson"><span>Name: </span><input type="text" class="form-control input-sm" name="name" autocomplete="off"></p><p class="mt10 divGroup none"><span>Name: </span><select class="slcDepartmentType form-control input-sm" name="departmentType" style="width:120px !important"></select><select class="slcDepartment form-control input-sm" name="name" style="width:280px !important"></select></p><div class="dialogBottom"><button class="btn btn-primary w100 mr20 btnSub">Add</button><button class="btn btn-default w100 ml20" onclick="oc.dialog.close();">Cancel</button></div>';oc.dialog.open("Add",b);var d=$(".zDialog"),e=a.data();if(c.model={parentId:c.parentModel.id,familyName:c.parentModel.familyName},(2==e.nodeType||21==e.nodeType)&&(c.model.nodeType=21,d.find(".pType, .divGroup, .jsAddTeam").remove()),e.nodeType){oc.ui.autoComplete(d.find('.divPerson [name="name"]'),c.allUserName);var f=d.find('.divGroup [name="name"]'),g=d.find('[name="departmentType"]');c.config.teamData.map(function(a){f.append('<option value="'+a.id+'">'+a.name+"</option>"),a.type&&0===g.find('option:contains("'+a.type+'")').length&&g.append("<option>"+a.type+"</option>")}),g.on("change",function(){f.html("");var a=this.value;c.config.teamData.map(function(b){b.type==a&&f.append('<option value="'+b.id+'">'+b.name+"</option>")})}),d.on("change",'[name="addType"]',function(){"group"===this.value?($(".divGroup").show(),$(".divPerson").hide()):($(".divPerson").show(),$(".divGroup").hide())})}else{d.find(".pType, .jsAddTeam").remove();var h='<p><span class="w100 mt10">Forbid Team:</span><input type="checkbox" name="forbidTeam" class="zToggleBtnSm"></p><p><span class="w100 mt10 mb10">Allow Dup:</span><input type="checkbox" name="allowDup" class="zToggleBtnSm"></p>';d.find(".divPerson").prepend(h),oc.ui.toggleBtn("YES","NO")}d.on("click",".btnSub",function(){var b=$(this);if(!c.checkDialogName(d))return!1;if(!e.nodeType)return c.model={name:c.model.name,forbidTeam:$('[name="forbidTeam"]').prop("checked")?1:0,allowDup:$('[name="allowDup"]').prop("checked")?1:0},void oc.ajax.post("/product/rest/v1/user_groups/family",c.model,function(b){var d=a.find(">ul");0===d.length&&(d=$("<ul></ul>").appendTo(a));var e=$('<li class="zTreeItem zTreeItemFolder"><p><span class="pName">'+c.model.name+'</span><span class="treeCountMember">0</span></p></li>');c.model.familyName=b,0===c.model.forbidTeam?c.model.nodeType=1:c.model.nodeType=2,e.data(c.model),e.appendTo(d),oc.dialog.close(),oc.dialog.tips("Add success.")});if(2!==c.model.nodeType&&21!==c.model.nodeType){var f=$('[name="addType"]:checked').val();"person"==f?c.model.nodeType=11:c.model.nodeType=10}else c.model.nodeType=21;var g=null;21===c.model.nodeType||11===c.model.nodeType?(g=c.getUserByFullName(c.model.name),c.model.name=g.name):g=c.getTeamById(c.model.name);var h=b.html();b.html('<i class="zLoadingIcon mr5"></i>'+h+"...").attr("disabled",!0),c.addNode(c.model,function(d,e){if(d){oc.dialog.close();var f=a.find(">ul");0===f.length&&(f=$("<ul></ul>").appendTo(a)),c.model.id=e;var i=$('<li class="zTreeItem" draggable="true" data-type="'+c.model.nodeType+'"><p><span class="pName">'+(g.fullName||g.name)+"</span></p></li>");if(10==c.model.nodeType)i.addClass("zTreeItemFolder");else if(21==c.model.nodeType){i.addClass("zTreeItemReport");var j=f.parents(".zTreeItem:eq(0)").find(">p>.treeCount"),k=parseInt(j.html())||0;j.html(++k)}if(c.model.addOn=g,11==c.model.nodeType||21==c.model.nodeType){var l=g.img;l&&i.find(">p").addClass("pImg").append('<img src="'+l+'" />');var j=f.parents('.zTreeItem[data-type="1"], .zTreeItem[data-type="2"]').find(".treeCountMember"),k=parseInt(j.html())||0;k++,j.html(k)}i.data(c.model),i.appendTo(f)}else b.removeAttr("disabled").html(h),oc.dialog.tips("Add node fail:"+e)})}).on("click",".jsAddTeam",function(b){b.preventDefault(),c.showTeamPanel(function(b){c.dialog(a),$('.zDialog [name="addType"]').get(1).checked=!0,$(".zDialog .divGroup").fadeIn(),$(".zDialog .divPerson").fadeOut(),$(".zDialogCover .slcDepartment").val(b.id)})})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){console.log(a),setTimeout(b,2e3)},c.moveNode=function(a,b,c){setTimeout(function(){c(!0)},2e3)},c.sortNode=function(a,b,c){setTimeout(function(){c(!0)},2e3)},c.showTeamPanel=function(){},c.render()};b.exports=d},{}],25:[function(a,b,c){var d=function(a){this.config={container:"body",data:null,showLevel:1},this.ele=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c.config.allUser&&(c.allUserName=[],c.config.allUser.map(function(a){c.allUserName.push(a.name)})),c.render=function(){c.ele=$('<ul class="zTree"></ul>');var a=$('<li class="zTreeItem"><p>'+c.config.data.name+"</p></li>").data(c.config.data);a.appendTo(c.ele),c._renderRecusive(c.config.data.items,a,0),$(this.config.container).find(".zTree").remove(),$(this.config.container).append(c.ele),c._bindEvents()},c.filter=function(a){c.removeFilterTag(),a&&(a=a.toUpperCase(),c.ele.find(".zTreeItem:gt(0)").removeClass("active").each(function(){var b=$(this),c=b.find(">p").html().toUpperCase();0===c.indexOf(a)&&(b.parents(".zTreeItem").addClass("active"),b.addClass("treeSearch"))}))},c.removeFilterTag=function(){c.ele.find(".treeSearch").removeClass("treeSearch")},c._renderRecusive=function(a,b,d){if(a){var e=a.length;e>0&&b.addClass("hasMore"),d<this.config.showLevel&&b.addClass("active");for(var f=$("<ul></ul>"),g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeItem" draggable="true" data-level="'+h.level+'"><p>'+h.name+"</p></li>");h.description&&i.addClass("zTreeItemDes").find(">p").attr("title",h.description),i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._bindEvents=function(){c.ele.on("click",".zTreeItem p",function(){var a=$(this).parent();a.toggleClass("active")}).on("mouseenter",".zTreeItem p",function(){var a=$(this);$('<span class="zTreeControl"><i class="icon-plus2" title="Add"></i><i class="icon-cog" title="Setting"></i><i class="icon-align-justify" title="Show MN list"></i></span>').hide().appendTo(this).fadeIn(1e3),a.hasClass("zTreeAdd")&&a.find(".icon-align-justify").removeClass("icon-align-justify").addClass("icon-minus2")}).on("mouseleave",".zTreeItem p",function(){$(this).find(".zTreeControl").remove()}).on("click",".icon-cog",function(a){a.stopPropagation(),$(".treeRightContainer").removeClass("active");var b=$(this).parent().parent(),d=b.parent(),e=d.data();if(e.level<4)b.addClass("zTreeEdit"),b.html('<input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="category, separate by dot or space"><i class="iconRight icon-checkmark" title="Save"></i>'),b.find('[name="name"]').val(e.name),b.find('[name="description"]').val(e.description);else if(4===e.level)$.get("/product/rest/v1/pis/categories/"+e.id+"/singularities",function(a){console.log(a),c.parentLi=null,c.currentLi=d;var b=$("#treeRightContainer").addClass("active");b.find('[name="name"]').val(e.name),b.find('[name="itemDescription"]').val(e.description),b.find("#aEditSubCategory").show(),b.find(".trBtns").hide(),b.find('[name="singularityName"]').each(function(b,c){var d=$(c).parent().next("td").find("input");if(a.length<=b)c.value="",c.removeAttribute("data-id"),d.val("");else{var e=a[b];c.value=e.singularityName,c.setAttribute("data-id",e.id),d.val(e.description)}}),b.find(".form-control").attr("disabled",!0)});else{$("#treeRightContainer2").addClass("active")}}).on("click",".zTreeEdit input, .zTreeEdit i, .zTreeControl",function(a){a.stopPropagation()}).on("click",".icon-checkmark",function(a){a.stopPropagation();var b=$(this),d=b.parents(".zTreeItem:eq(0)"),e=d.data();if(!e||!e.id){e={};var f=d.parents(".zTreeItem:eq(0)").data();e.descendant=f.id}if(e.categoryName=d.find('[name="name"]').val(),e.description=d.find('[name="description"]').val(),!e.categoryName)return oc.dialog.tips("Name is required"),void d.find('[name="name"]').focus();b.removeClass("icon-checkmark").addClass("zLoadingIcon"),d.removeClass("zTreeItemDes");var g=function(a){return a===!1?void b.removeClass("zLoadingIcon").addClass("icon-checkmark"):(d.parents(".zTreeItem").addClass("hasMore"),e.level||(e.level=parseInt(f.level)+1),e.name=e.categoryName,d.data(e).find(">p").html(e.categoryName).removeClass("zTreeEdit zTreeAdd"),void(e.description&&d.addClass("zTreeItemDes").find("p").attr("title",e.description)))};e.id?c.updateNode(e,g):c.addNode(e,g)}).on("click",".icon-plus2",function(a){a.stopPropagation(),$(".treeRightContainer").removeClass("active");var b=$(this).parents(".zTreeItem:eq(0)").addClass("active"),d=b.data();if(d.level<3){var e=b.find(">ul");0===e.length&&(e=$("<ul></ul>").appendTo(b));var f=$('<li class="zTreeItem"></li>');f.append('<p class="zTreeEdit zTreeAdd"><input type="text" name="name" placeholder="name"><input type="text" name="description" placeholder="description"><i class="iconRight icon-checkmark" title="Save"></i></p>'),f.appendTo(e)}else if(c.currentLi=null,c.parentLi=b,3===d.level){var g=$("#treeRightContainer");g.addClass("active").find("input").removeAttr("disabled").val(""),g.find("#aEditSubCategory").hide(),g.find(".trBtns").show()}}),c.initRightForm()},c.initRightForm=function(){var a=$("#treeRightContainer form");a.submit(function(){var b={category:{categoryName:$('[name="name"]').val(),description:$('[name="itemDescription"]').val()},singularities:[]};a.find('[name="singularityName"]').each(function(){var a=$(this).parent().next("td").find("input"),d={singularityName:this.value,description:a.val(),singularityCode:b.singularities.length};c.parentLi||(d.id=this.getAttribute("data-id")),b.singularities.push(d)});var d=a.find('button[type="submit"]').html('<i class="zLoadingIcon"></i>').attr("disabled",!0);return c.parentLi?(b.category.descendant=c.parentLi.data().id,oc.ajax.post("/product/rest/v1/pis/categories/subcategory",b,function(a){d.html("Save").removeAttr("disabled"),oc.dialog.tips("Add success.");var e={id:a,fid:b.category.descendant,name:b.category.categoryName,description:b.category.description},f=c.parentLi.find("ul:eq(0)");0===f.length&&(f=$("<ul></ul>").appendTo(c.parentLi));var g=$('<li class="zTreeItem zTreeItemDes"><p title="'+e.description+'">'+e.name+"</p></li>").appendTo(f);g.data(e),c.parentLi.addClass("hasMore")},function(a){oc.dialog.tips("Update failed:"+a.responseText),d.html("Save").removeAttr("disabled")})):oc.ajax.put("/product/rest/v1/pis/categories/subcategory/"+c.currentLi.data().id,b,function(a){d.html("Save").removeAttr("disabled"),oc.dialog.tips("Update success."),$(".treeRightContainer").removeClass("active").find("input").val("");var e=c.currentLi.data();e.name=b.category.categoryName,e.description=b.category.description,c.currentLi.find(">p").html(e.name).attr("title",e.description),c.currentLi.data(e)},function(a){oc.dialog.tips("Update failed:"+a.responseText),d.html("Save").removeAttr("disabled")}),!1});var b=$("#treeRightContainer2 form");b.submit(function(){var a={};return a.subCategoryId=b.find("#categoryName").attr("data-id"),a.segmentId=b.find('select[name="sigment"]').val(),a.segmentText=b.find('select[name="sigment"]').find(":selected").text(),a.singularityId=b.find('select[name="singularity"]').val(),a.singularityText=b.find('select[name="singularity"]').find(":selected").attr("data-id"),a.countryCodeId=b.find('select[name="country"]').val(),a.countryCodeText=b.find('select[name="country"]').find(":selected").attr("data-code"),a.colorCodeId=b.find('select[name="color"]').val(),a.colorCodeText=b.find('select[name="color"]').find(":selected").attr("data-code"),oc.ajax.post("/product/rest/v1/pis/structure",a,function(a){console.log(a),oc.dialog.tips("Add success, MN is:<b>"+a.text+"</b>",3e3),$("#treeRightContainer2").removeClass("active"),window.open("/product/index.htm?mo=good&sku_add="+a.text)}),!1})},c.deleteNode=function(a,b){b()},c.updateNode=function(a,b){setTimeout(b,2e3)},c.addNode=function(a,b){console.log(a),setTimeout(b,2e3)},c.render()};b.exports=d},{}],26:[function(a,b,c){var d=function(a){this.config={container:"body",dataList:null,iptClass:"",width:"auto",height:"auto",showAll:!1,forbidPNode:!1},this.timerHandler=null,this.selectedItem=null,this.selectedList=null,this.ele=null,this.filterParams={},this.valueChangeHanlder=null;for(var b in a)this.config.hasOwnProperty(b)&&(this.config[b]=a[b]);var c=this;c._render=function(){c.ele=$('<div class="zTreeSelect"><input type="text" style="width:'+this.config.width+'"></div>'),c.config.iptClass&&c.ele.find("input").addClass(c.config.iptClass),c._renderRecusive(c.config.dataList,c.ele,0),c.ele.appendTo($(c.config.container));var a=c.ele.offset().top,b=$(document).height(),d=b-a-150;150>d&&(d=150),c.ele.find(">ul").css("max-height",d),c._bindEvents(),c.config.showAll&&c.ele.find("input").val("All")},c._selectedP=function(a){if(0!==a.length){var b="";c.selectedItem=a.parent().data(),c.selectedList=[],a.parents(".zTreeSelectItem").each(function(){var a=$(this),d=a.data();c.selectedList.push(d),b=b?d.name+" - "+b:d.name}),c.selectedList.reverse(),c.ele.find("input").val(b).attr("data-id",c.selectedItem.id||""),c.ele.removeClass("active"),"All"===a.html()&&c.ele.find("input").val("All"),c.valueChangeHanlder&&c.valueChangeHanlder()}},c._setActive=function(){var a=c.ele.find(".zTreeSelectItem.active").data();a&&a.id?c.ele.find(".zTreeSelectItem:visible").each(function(b,d){var d=$(d);return d.data().id==a.id?(c.currentActive=b,!1):void 0}):c.currentActive=null},c._bindEvents=function(){c.ele.on("click",function(a){c.filterParams={name:"",description:""},a.stopPropagation(),c.ele.hasClass("active")||"disabled"==c.ele.attr("disabled")||"disabled"===c.ele.find("input").attr("disabled")||(c.ele.addClass("active"),c._setActive(),c.filter(),c.selectedItem&&c.ele.find(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();b==c.selectedItem&&(a.addClass("active"),c.ele.find(">ul").scrollTop(a.offset().top-32))}))}).on("click","p",function(a){a.stopPropagation();var b=$(this);c.config.forbidPNode&&b.parent().find("ul>li").length>0||c._selectedP(b)}).on("input","input",function(a){c.ele.find(".zTreeSelectItem.active").removeClass("active"),c._clear(),c.filterParams.name=this.value,c.filter()}).on("mouseenter","li.zTreeSelectItem p",function(){c.ele.find(".zTreeSelectItem.active").removeClass("active"),$(this).parent().addClass("active"),c._setActive()}).find("input").on("keyup",function(a){a.preventDefault();var b=a.keyCode,d=c.ele.find(".zTreeSelectItem.active");if(13===b){var e=d.find(">p");return void c._selectedP(e)}if(40===b||38===b){if(40===b)0==d.length&&(c.currentActive=-1),c.currentActive++;else{if(!c.currentActive)return;c.currentActive--}var f=c.ele.find(".zTreeSelectItem:visible:eq("+c.currentActive+")");if(0!=f.length){c.ele.find(".zTreeSelectItem.active").removeClass("active"),f.addClass("active");var g=c.ele.find(">ul"),h=g.height(),i=f.offset().top,j=g.scrollTop();if(40===b){var k=i-h;k>0&&g.scrollTop(k+j)}else{var k=i-j;100>i&&g.scrollTop(j-32)}}}}).on("blur",function(){c.timerHandler&&clearTimeout(c.timerHandler),c.timerHandler=setTimeout(function(){c.ele.removeClass("active"),c.selectedItem||(c.filterParams.name=null,c.config.showAll?c.ele.find("input").val("All"):c.ele.find("input").val(""))},200)})},c._clear=function(){c.selectedItem=null,c.selectedList=[]},c.setSelected=function(a){if(!a)return c.selectedItem=null,c.selectedList=[],c.ele.find("input").val(""),void(c.config.showAll&&c.ele.find("input").val("All"));var b=null;c.selectedList=[];var d="";return c.ele.find("li").each(function(){var e=$(this),f=e.data();return f&&f.id&&f.id==a?(b=e,c.selectedItem=e.data(),c.selectedList.push(c.selectedItem),d=f.name,!1):void 0}),b?(b.parents(".zTreeSelectItem").each(function(){var a=$(this),b=a.data();c.selectedList.push(b),d=b.name+" - "+d}),c.selectedList.reverse(),c.ele.find("input").val(d),c.config.showAll&&""==d&&c.ele.find("input").val("All"),c.selectedList):void 0},c.filter=function(){c.ele.find("li.zTreeSelectItem").removeClass("hidden").show(),c.filterParams&&(c.filterParams&&c.filterParams.description&&c.ele.find('li.zTreeSelectItem[data-level="1"]').addClass("hidden").each(function(){var a=$(this),b=a.data();b.description&&-1===b.description.indexOf(c.filterParams.description)||a.removeClass("hidden")}),c.filterParams.name&&c.ele.find("li.zTreeSelectItem:visible").hide().each(function(){var a=$(this),b=a.data();b.name&&b.name.toUpperCase().indexOf(c.filterParams.name.toUpperCase())>-1&&(a.show(),a.find("li").show(),a.parents("li.zTreeSelectItem").show())}))},c._renderRecusive=function(a,b,d){if(a){var e=a.length,f=$("<ul></ul>");0===d&&(f.css("max-height",c.config.height),c.config.showAll&&$('<li class="zTreeSelectItem" data-level="0"><p style="padding-left:10px">All</p></li>').appendTo(f));for(var g=0;e>g;g++){var h=a[g],i=$('<li class="zTreeSelectItem" data-level="'+d+'"><p style="padding-left:'+(20*d+10)+'px">'+h.name+"</p></li>");i.appendTo(f).data(h),h.items&&h.items.length>0&&c._renderRecusive(h.items,i,d+1)}e>0&&f.appendTo(b)}},c._render()};b.exports=d},{}],27:[function(require,module,exports){var toolsDojo=require("./toolsDojo"),UI={};UI.toggleBtn=function(a,b){void 0===a&&(a="ON",b="OFF");var c=this;$(".zToggleBtn, .zToggleBtnSm").each(function(){var d=$(this);c.toggleOneBtn(d,a,b)})},UI.toggleOneBtn=function(a,b,c){var d="zToggleBtn";a.removeClass("zToggleBtn"),a.hasClass("zToggleBtnSm")&&(a.removeClass("zToggleBtnSm"),d+=" zToggleBtnSm");var e=a[0].checked;e&&(d+=" active");var f=$('<span class="'+d+'"><i class="zToggleBtnON">'+b+'</i><i class="zToggleBtnOFF">'+c+"</i>"+a[0].outerHTML+"</span>");a.replaceWith(f),f.find("input").prop("checked",e),f.off("change","input").on("change","input",function(){this.checked?$(this).parents(".zToggleBtn:eq(0)").addClass("active"):$(this).parents(".zToggleBtn:eq(0)").removeClass("active")})},UI.autoComplete=function(ele,array,cb,prefix,autoAddPrefix){ele=$(ele),ele.attr("autocomplete","off"),"function"==typeof array&&(cb=array,array=null),ele.off("keyup").off("keydown").off("blur").data("cb",cb),ele.on("keydown",function(a){var b=$(this),c=b.next("ul.zAutoComplete");return 13===a.keyCode&&c.find("li.active").length>0?(event.preventDefault(),!1):void 0}),ele.on("keyup",function(e){var ipt=$(this),cb=ipt.data("cb"),ul=ipt.next("ul.zAutoComplete");if(40!==e.keyCode){if(38===e.keyCode){var focusLi=ul.find("li.active");if(0===focusLi.length)return;var prevLi=focusLi.prev("li");return void(prevLi.length>0&&(prevLi.addClass("active"),focusLi.removeClass("active")))}if(13!==e.keyCode){var source=array;if(!array){var sourceString=ipt.attr("data-source");source=sourceString?eval(sourceString):ipt.data("source")}if(source){$(".zAutoComplete").remove();var val=$.trim(this.value);if(prefix&&(val=val.replace(/.*;|.*,|.*\s/g,"")),val){var matchedArray=source.filter(function(a){return a.toUpperCase().indexOf(val.toUpperCase())>-1}),len=matchedArray.length;if(0!==len){len>8&&(len=8);for(var ul=$('<ul class="zAutoComplete"></ul>'),i=0;len>i;i++)ul.append('<li tabindex="0">'+matchedArray[i]+"</li>");var top=ipt.position().top+ipt.outerHeight(),left=ipt.position().left;ul.css({top:top,left:left}).on("click","li",function(){var a=$(this).html(),b=ipt.val();if(prefix){var c=b.match(/(.|,|\s)*(;|,|\s)/);b="",c&&c.length>0&&(b=c[0]);var d=b+a;autoAddPrefix===!0&&(d+="string"==typeof prefix?prefix:","),ipt.val(d)}else ipt.val(a);$(".zAutoComplete").remove(),ipt.change(),cb&&cb(a,ipt)}).on("mouseenter","li",function(){ul.find(".active").removeClass("active"),$(this).addClass("active")}),ipt.after(ul)}}}}else{var focusLi=ul.find("li.active");if(focusLi.length>0){var slcVal=focusLi.html(),text=ipt.val();if(prefix){var mathedArray=text.match(/(.|,|\s)*(;|,|\s)/);text="",mathedArray&&mathedArray.length>0&&(text=mathedArray[0]);var value=text+slcVal;autoAddPrefix===!0&&(value+="string"==typeof prefix?prefix:","),ipt.val(value)}else ipt.val(slcVal);ipt.change(),ul.remove(),cb&&cb(slcVal,ipt)}}}else{var focusLi=ul.find("li.active");if(0===focusLi.length)ul.find("li:eq(0)").addClass("active");else{var nextLi=focusLi.next("li");nextLi.length>0&&(nextLi.addClass("active"),focusLi.removeClass("active"))}}}).on("blur",function(){setTimeout(function(){$(".zAutoComplete").remove()},200)})},UI.cbx=function(){return $(".zCbx").off("change","input").on("change","input",function(){this.checked?$(this).parent().addClass("active"):$(this).parent().removeClass("active")}),{check:function(a){if(!a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.addClass("active").find("input:checkbox")[0].checked=!0}},unCheck:function(a){if(a.hasClass("zCbx")){if(0===a.find("input:checkbox").length)return console.warn("zCkb does not contain a input:checkbox item");a.removeClass("active").find("input:checkbox")[0].checked=!1}}}},UI.multiSelect=function(a){$("select.zMultiSelect").each(function(){var a=$(this),b=a.outerWidth(),c=a.outerHeight()+"px",d=a.attr("name");void 0===d&&(d="");var e=$('<div class="zMultiSelect"><div class="zMultiSelectText"></div><div class="zMultiSelectMain"><ul></ul></div></div>');e.css("width",b),e.find(".zMultiSelectText").css({height:c,"line-height":c}).html(a.attr("data-slc"));var f="";a.find("option").each(function(a,b){f+='<li><label class="zCbx"><input type="checkbox", name="'+d+'" value="'+b.value+'">'+b.innerHTML+"</label></li>"}),f+='<li><button class="btnPrimary btnXs" type="button">Confirm</button></li>',e.find("ul").html(f),a.replaceWith(e)}),UI.cbx();var b=function(){var b=$(".zMultiSelect");b.on("click",".zMultiSelectText",function(){var a=$(this).parents(".zMultiSelect:eq(0)");if(a.hasClass("active"))a.removeClass("active").find(".zMultiSelectMain").hide();else{a.addClass("active").find(".zMultiSelectMain").show();var b=this.innerHTML,c=b.split(";");a.find(".zCbx").removeClass("active").find("input:checkbox").attr("checked",!1);for(var d in c){var e=c[d],f=a.find('input:checkbox[value="'+e+'"]');f.length>0&&(f[0].checked=!0,f.parent().addClass("active"))}}}).on("click","button",function(b){var c=$(this).parents(".zMultiSelect:eq(0)"),d=$(this).parents(".zMultiSelectMain:eq(0)"),e="";d.find("input:checked").each(function(){e+=this.value+";"}),e&&(e=e.slice(0,-1)),c.removeClass("active").find(".zMultiSelectText").html(e),d.hide(),b.stopPropagation(),
a&&a(c)}).click(function(a){a.stopPropagation()}),$("html").click(function(){b.removeClass("active").find(".zMultiSelectMain").hide()})};b()},UI.popOver=function(a,b,c,d){if(a=$(a),a.next(".zPopOver").length>0)return void a.next(".zPopOver").remove();var e=$('<div class="zPopOver zPopOver'+d+'"></div>');e.append('<div class="zPopOverTitle">'+b+'<i class="icon-close"></i></div>'),e.append('<div class="zPopOverContent">'+c+"</div>"),a=$(a);var f=a.position();a.after(e);var g=f.left+a.outerWidth()+20,h=f.top+a.outerHeight()/2-e.outerHeight()/2-5;"left"===d?g=f.left-e.outerWidth()-20:"top"===d?(g=f.left-e.outerWidth()/2+a.outerWidth()/2,h=f.top-e.outerHeight()-20):"bottom"===d&&(g=f.left-e.outerWidth()/2+a.outerWidth()/2,h=f.top+a.outerHeight()+20),e.css({left:g,top:h}),e.on("click",".zPopOverTitle i.icon-close",function(){e.remove()})},UI.popOverRemove=function(a){var a=$(a);a.hasClass(".zPopOver")?a.remove():a.next(".zPopOver").remove()},UI.slide=function(a,b){var c="fixRight"+(new Date).getTime(),d=$('<div id="'+c+'" class="zFixRight"><div class="fixRightHd"><i class="icon-arrow-right fixRightClose"></i><i class="icon-fullscreen fixRightFullScreen"></i></div><div class="fixRightBd"></div></div>');return d.appendTo(document.body),b&&d.find(".fixRightFullScreen").css("display","block"),setTimeout(function(){a?(d.prepend("<style>#"+c+".zFixRight.active{width: "+a+"px;}</style>"),d.addClass("active")):d.addClass("active")},50),d.on("click",".fixRightClose",function(a){d.removeClass("active"),d.data("target")&&$(d.data("target")).find("tr.success").removeClass("success"),setTimeout(function(){d.onClose&&d.onClose(),d.data("target")&&$(d.data("target")).find("tr.success").removeClass("success"),toolsDojo.destroyByNode(d.find(".fixRightBd")[0]),d.remove()},300)}).on("click",".fixRightFullScreen",function(a){var b=document.getElementById("ocOutWrap")||document.body,c=b.clientWidth;parseInt(d.css("width"))==c?d.css("width",""):d.css("width",c+"px")}),d},UI.destroySlide=function(a){a||(a=$(".zFixRight")),a.each(function(){var a=$(this);a.removeClass("active"),a.data("target")&&$(a.data("target")).find("tr.success").removeClass("success"),toolsDojo.destroyByNode(a.find(".fixRightBd")[0]),a.find(".fixRightBd").html(""),setTimeout(function(){a.onClose&&a.onClose(),a.remove()},300)})},UI.loading=function(a,b){b?$(a).removeClass("zLoadingCover"):$(a).addClass("zLoadingCover")},UI["export"]=function(a,b){a&&window.open(a)},module.exports=UI},{"./toolsDojo":18}],28:[function(a,b,c){var d=function(a){var b=this;this.config={container:"body",auto:!1,maxSize:10,uploadAction:"/upload",postParams:{},oneFileLimit:10485760,callback:null,uploadOneCallback:null,checkFileCallback:null},this.deleteFile=null,this.STATUS={waiting:0,process:1,success:2,failed:3},this.files=[],this.ele=null,this.msg="",this.queueSize=0,this.uploadedSize=0,this.slice=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;for(var c in a)this.config.hasOwnProperty(c)&&(this.config[c]=a[c]);b._renderFoot=function(){var a=$('<div class="zUploaderFoot"></div>');return a.append('<p class="zUploaderStatic">选中0个文件，共0K</p>'),a.append('<span class="zUploaderControl"><span class="zUploaderFileBtn"><input type="file" multiple="multiple" /><span class="zUploaderBtnText">继续添加</span></span><button class="zUploaderBtn" type="button">开始上传</button></span>'),b.config.auto&&a.find(".zUploaderBtn").remove(),a},b._renderNoFile=function(){var a=$('<div class="zUploaderNoFile"></div>');return a.append('<div class="icon"><i class="icon-images"></i></div>'),a.append('<span class="zUploaderFileBtn "><input type="file" multiple="multiple" /><span class="zUploaderBtnText">点击选择文件</span></div>'),a.append("<p>或将文件拖到这里，单次最多可上传文件"+b.config.maxSize+"个</p>"),a},b._render=function(){b.ele=$('<div class="zUploader"></div>');var a=$('<div class="zUploaderList"></div>');a.append(b._renderNoFile());var c=b._renderFoot().hide();b.ele.append(a),b.ele.append(c),b.ele.appendTo(b.config.container)},b.reloadList=function(){b.ele.find(".zUploaderItem").remove();var a=b.files.length;if(0===a)return b.ele.find(".zUploaderNoFile").show(),void b.ele.find(".zUploaderFoot").hide();b.ele.find(".zUploaderNoFile").hide(),b.ele.find(".zUploaderFoot").show();for(var c=b.ele.find(".zUploaderList"),d=0,e=0,f=0;a>f;f++){var g=b.files[f];g.status==b.STATUS.waiting&&(d+=g.size,e++);var h=b._renderOneFile(g);g.target=h,c.append(h)}b.files.length<b.config.maxSize&&b.ele.find(".zUploaderFoot .zUploaderFileBtn").show(),b.ele.find(".zUploaderStatic").html("选中"+e+"个文件，共"+(d/1e3).toFixed(2)+"K")},b.clear=function(){b.files=[],b.reloadList()},b._pushFiles=function(a){for(var c=0;c<a.length;c++){var d=a[c],e=b.files.filter(function(a){return a.name==d.name&&a.lastModified==d.lastModified&&a.size==d.size});if(e.length>0)oc.dialog.tips(d.name+"文件已经存在");else if(d.size>b.config.oneFileLimit)oc.dialog.tips("文件"+d.name+"超出了最大限制（"+parseInt(b.config.oneFileLimit/1024)+"K)");else{if(b.files.length===b.config.maxSize)return alert("超出了最大文件数量"),!1;b.files.length>=b.config.maxSize-1&&b.ele.find(".zUploaderFoot .zUploaderFileBtn").hide(),(!b.config.checkFileCallback||b.config.checkFileCallback(d))&&(a[c].status=b.STATUS.waiting,b.files.push(a[c]))}}b.reloadList(),b.config.auto&&b._upload()},b._deleteFile=function(a){if(b.files[a].status===b.STATUS.process)return alert("该文件当前不允许删除");var c=b.files[a];c.status===b.STATUS.success?b.deleteFile&&b.deleteFile(c,function(){b.files.splice(a,1),b.reloadList()}):(b.files.splice(a,1),b.reloadList())},b._bindEvent=function(){b.ele.on("change",'.zUploaderFileBtn input[type="file"]',function(){b._pushFiles(this.files),$(this).replaceWith(this.outerHTML)}).on("click",".zUploaderBtn",b._upload).on("click",".zUploaderItemHd i",function(){var a=$(this).parents(".zUploaderItem"),c=a.index();b._deleteFile(c-1)}).on("click",".zUploaderReset",function(a){b.files.map(function(c){c.status=b.STATUS.waiting,c.msg="",c.target.find(".zUploaderMsg").removeClass("error").html(""),a.preventDefault()})}),b.ele[0].addEventListener("drop",function(a){a.preventDefault(),b._pushFiles(a.dataTransfer.files)}),$(document).on({dragleave:function(a){a.preventDefault()},drop:function(a){a.preventDefault()},dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()}})},b._renderOneFile=function(a){var c=$('<div class="zUploaderItem"></div>');c.append('<div class="icon"><i class="icon-images"></i></div>'),c.append('<p class="zUploaderMsg"></p>'),c.append('<div class="zUploaderItemHd"><i class="icon-cross"></i></div>');var d=a.name;if(d.length>25&&(d=d.slice(0,20)+" ..."),c.append('<p class="zUploaderName">'+d+"</p>"),a.status===b.STATUS.success?(c.find(".zUploaderMsg").addClass("ok").html("upload success"),b.deleteFile||c.find(".zUploaderItemHd").remove()):a.status===b.STATUS.failed&&c.find(".zUploaderMsg").addClass("error").html("upload failed").attr("title",a.msg),/image\/\w+/.test(a.type)){var e=new FileReader;e.onload=function(){var a=e.result;c.find(".icon i").replaceWith('<img src="'+a+'" />')},e.readAsDataURL(a)}return c},b.setStatus=function(a,c,d){a.status=c,c===b.STATUS.success?(a.target.find(".zUploaderMsg").addClass("ok").html("upload success"),b.deleteFile||a.target.find(".zUploaderItemHd").remove(),a.status=b.STATUS.success):c===b.STATUS.failed&&(a.target.find(".zUploaderMsg").addClass("error").html("upload failed").attr("title",d),a.status="failed")},b._uploadOneFile=function(a,c){return b.setStatus(a,b.STATUS.process),window.FormData&&window.XMLHttpRequest?void b._sendFileByFormData(a,c):void 0},b._sendFileByFormData=function(a,c){var d=new XMLHttpRequest;if(0===a.size)return b.setStatus(a,b.STATUS.failed,"文件大小为0"),void c();d.open("POST",b.config.uploadAction,!0);var e=new FormData;e.append("file",a),d.upload.onload=function(a){console.log("onload",a.loaded)},d.upload.onprogress=function(c){console.log("process"),b._process(c.loaded*a.size/c.total,!0)},d.upload.onerror=function(d){b._process(a.size),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+res.statusText),c()},d.onreadystatechange=function(){if(console.log("status change"),3==d.readyState&&console.log(d),4==d.readyState&&200!==d.status)return b._process(0),b.setStatus(a,b.STATUS.failed,"文件传输中断:"+d.statusText),void c();if(4==d.readyState&&200==d.status){b._process(a.size);try{a.response=JSON.parse(d.response),a.response.flag===!0?b.setStatus(a,b.STATUS.success):b.setStatus(a,b.STATUS.failed)}catch(e){console.log("uploader未知错误",e),b.setStatus(a,b.STATUS.failed)}c()}},d.send(e)},b._process=function(a,c){var d=b.ele.find(".zUploaderStatic"),e=d.find(".zUploaderProcess");0===e.length&&(d.html(""),e=$('<span class="zUploaderProcess"><span class="zUploaderProcessInner"></span></span>').appendTo(d),eleProcesText=$('<span class="zUploaderProcessText"></span>').appendTo(d));var f=b.uploadedSize+a,g=.9*b.queueSize;if(f>g&&(f=g),0!==a){var h=0;0!==b.queueSize&&(h=100*f/b.queueSize),e.attr("data-count",f).find(".zUploaderProcessInner").css("width",h+"%")}d.find(".zUploaderProcessText").html("( "+(f/1e3).toFixed(2)+" KB / "+(b.queueSize/1e3).toFixed(2)+" KB )"),c!==!0&&(b.uploadedSize+=a)},b._upload=function(){var a=b.files.filter(function(a){return a.status===b.STATUS.process});if(a.length>0)return alert("有文件正在上传，请稍后...");b.queueSize=0,b.uploadedSize=0;var c=b.files.filter(function(a){return a.status===b.STATUS.waiting?(b.queueSize+=a.size,!0):!1});b.config.auto&&b.ele.find(".zUploaderFileBtn").hide(),b._process(0);var d=0,e=function(){return d===c.length?(b.ele.find(".zUploaderFileBtn").show(),b._setFootStatics(),void(b.config.callback&&b.config.callback(b.files))):void b._uploadOneFile(c[d],function(){b.config.uploadOneCallback&&b.config.uploadOneCallback(c[d]),e(d++)})};e()},b._setFootStatics=function(){var a=b.files.filter(function(a){return a.status==b.STATUS.success}),c=a.length,d=b.files.length-c,e="已成功上传"+c+"个文件";d>0&&(e+="，"+d+'个文件上传失败，<a class="zUploaderReset" href="#">重置失败文件？</a>'),b.ele.find(".zUploaderStatic").html(e)},b._render(),b._bindEvent()};b.exports=d},{}]},{},[11]);